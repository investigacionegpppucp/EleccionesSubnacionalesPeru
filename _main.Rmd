--- 
title: "Fact checking de las Elecciones Subnacionales en Perú"
author: "Área de investigación e incidencia de la Escuela de Gobierno y Políticas
  Públicas - PUCP"
date: 'Equipo de trabajo: Jorge Aragón, Marylía Cruz, Karina Alcantará y Paolo Sanchez'
site: bookdown::bookdown_site
---

# Presentación

El Área de Incidencia e Investigación de la EGPP- PUCP presenta "Mitos y verdades de las Elecciones Subnacionales en el Perú", la cual tiene como objetivo presentar a detalle los principales mitos sobre los últimos seis procesos electorales subnacionales. 

- Elecciones Regionales y Municipales 2002

- Elecciones Regionales y Municipales 2006

- Elecciones Regionales y Municipales 2010

- Elecciones Regionales y Municipales 2014

- Elecciones Regionales y Municipales 2018

- Elecciones Regionales y Municipales 2022

<!--chapter:end:index.Rmd-->

# Participación Electoral

<font size="6"> **El porcentaje de participación electoral ha disminuído ¿Verdadero o Falso?.**</font>

Se observa que la participación electoral ha disminuído a partir de las Elecciones Regionales y Municipales del 2010. En el 2022, se registró el porcentaje más bajo de participación electoral. 




```{r,echo=FALSE,warning=FALSE,message=FALSE}
#library(googlesheets4)
#regional=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vRJdUE26KIgGmrUT8DEUzY5f3JsGlK0-eQdoTeWQw2SPrGpA_bI54jpSDnyE-hBBAoIsBRiAJzoghy-/pub?gid=2080689295&single=true&output=csv")


```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
#library(dplyr)
#library(tidyverse)
#library(car)
#regional_mito1 =regional%>% filter(Vuelta=="Primera")%>%
  #filter(Eleccion=="Regional 2002"|Eleccion=="Regional 2006"|Eleccion=="Regional 2010"|Eleccion=="Regional 2014"|Eleccion=="Regional 2018"|Eleccion=="Regional 2022")%>%
  #select(Region,V_emitidos,V_validos,Electores,Eleccion)%>%
  #unique()

#regional_mito1$Eleccion<-recode(regional_mito1$Eleccion, "'Regional 2002'='2002'; 'Regional 2006'='2006'; 'Regional 2010'='2010'; 'Regional 2014'='2014'; 'Regional 2018'='2018';'Regional 2022'='2022'")
#regional_mito1$Eleccion=as.factor(regional_mito1$Eleccion)


```




```{r,echo=FALSE,warning=FALSE,message=FALSE}

#regional_mito1 %>%
  #select(Region,V_emitidos,V_validos,Electores,Eleccion)%>%
  #group_by(Eleccion) %>%
  #summarise(across(c(Electores, V_emitidos,V_validos),sum))%>%
  #mutate(Participacion=(V_emitidos/Electores)*100)%>%
#ggplot(aes(x=Eleccion, y=Participacion, group=1)) +
  #geom_line(colour = "#e55555")+
  #geom_point()+
  #ggtitle("Porcentaje de Participación en Elecciones Regionales")+
  #xlab("Proceso Electoral")+
  #ylab("Porcentaje de Participación")+theme_minimal()+ylim(70,100)+
  #geom_text(aes(label=paste0(round(Participacion,0),"%"),vjust=-.9))
```


```{r,echo=FALSE,warning=FALSE,message=FALSE}

#regional_mito1 =regional_mito1%>% 
  #mutate(Participacion=(V_emitidos/Electores)*100)
```




```{r,echo=FALSE,warning=FALSE,message=FALSE}

#cities = unique(regional_mito1$Region)
#city_plots = list()
#for(Region_ in cities) {
  #city_plots[[Region_]] =ggplot(regional_mito1 %>% filter(Region == Region_), aes(x = Eleccion, y = Participacion, group=1)) + geom_line(colour="#122c74")+ 
  #geom_point()+ theme(axis.text = element_text(size=10))+ ggtitle(Region_)+
  #theme(legend.position = "none")+
  #xlab("Elección")+ 
  #ylab("Porcentaje de Participación")+theme_minimal()+theme()+ylim(65,100)+
    #geom_text(aes(label=paste0(round(Participacion,0),"%"),vjust=-.9))
  #print(city_plots[[Region_]])}
```




```{r,echo=FALSE,warning=FALSE,message=FALSE}

#provincial_mito1 %>%
  #select(Region,V_emitidos,V_validos,Electores,Eleccion)%>%
  #group_by(Eleccion) %>%
  #summarise(across(c(Electores, V_emitidos,V_validos),sum))%>%
  #mutate(Participacion=(V_emitidos/Electores)*100)%>%
#ggplot(aes(x=Eleccion, y=Participacion, group=1)) +
  #geom_line(colour = "#e55555")+
  #geom_point()+
  #ggtitle("Porcentaje de Participación en Elecciones Provinciales")+
  #xlab("Proceso Electoral")+
  #ylab("Porcentaje de Participación")+theme_minimal()+ylim(70,100)+
  #geom_text(aes(label=paste0(round(Participacion,0),"%"),vjust=-.9))
```


```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(googlesheets4)
distrital=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQMLHdXuz-ykbp9VmJJGhtl0vdNeeMxjgod2YrYLt9UB3RdX8tb-LEbZr2PVV41Sj384LuK1quysfNj/pub?gid=30541803&single=true&output=csv",dec=".")
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(dplyr)
library(plyr)
library(tidyverse)
library(car)
library(ggplot2)
library(rio)

distrital_mito1 =distrital%>% 
  filter(Eleccion=="Distrital 2002"|Eleccion=="Distrital 2006"|Eleccion=="Distrital 2010"|Eleccion=="Distrital 2014"|Eleccion=="Distrital 2018"|Eleccion=="Distrital 2022")%>%
  dplyr::select(Region,V_emitidos,V_validos,Electores,Eleccion)%>%
  unique()

```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito1$Eleccion<-recode(distrital_mito1$Eleccion, "'Distrital 2002'='2002'; 'Distrital 2006'='2006'; 'Distrital 2010'='2010'; 'Distrital 2014'='2014'; 'Distrital 2018'='2018';'Distrital 2022'='2022'")
distrital_mito1$Eleccion=as.factor(distrital_mito1$Eleccion)


```


```{r,echo=FALSE,warning=FALSE,message=FALSE}

distrital_mito1 %>%
  dplyr::select(Region,V_emitidos,V_validos,Electores,Eleccion)%>%
  group_by(Eleccion) %>%
  dplyr::summarise(across(c(Electores, V_emitidos,V_validos),sum))%>%
  mutate(Participacion=(V_emitidos/Electores)*100)%>%
ggplot(aes(x=Eleccion, y=Participacion, group=1)) +
  geom_line(colour = "#e55555")+
  geom_point()+
  ggtitle("Porcentaje de Participación en Elecciones Distritales")+
  xlab("Proceso Electoral")+
  ylab("Porcentaje de Participación")+theme_minimal()+ylim(70,100)+
  geom_text(aes(label=paste0(round(Participacion,0),"%"),vjust=-.9))
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
distrito_mito2 =distrital%>% 
  filter(Eleccion=="Distrital 2002"|Eleccion=="Distrital 2006"|Eleccion=="Distrital 2010"|Eleccion=="Distrital 2014"|Eleccion=="Distrital 2018"|Eleccion=="Distrital 2022")%>%
  dplyr::select(Region,Provincia,Distrito,Electores,V_emitidos,V_validos,Eleccion)%>%
  unique()%>%
  group_by(Region)%>%
  mutate(V_participacion=V_emitidos/Electores)%>%
  mutate(grupo= ifelse(Region=="AMAZONAS", "BAJAN", ifelse(Region=="AREQUIPA", "BAJAN", ifelse(Region=="APURIMAC", "BAJAN", ifelse(Region=="CAJAMARCA", "BAJAN", ifelse(Region=="CALLAO", "BAJAN", ifelse(Region=="CUSCO", "BAJAN", ifelse(Region=="LA LIBERTAD", "BAJAN", ifelse( Region=="LIMA", "BAJAN", ifelse(Region=="LORETO", "BAJAN", ifelse(Region=="MADRE DE DIOS", "BAJAN", ifelse(Region=="MOQUEGUA", "BAJAN", ifelse(Region=="PIURA", "BAJAN", ifelse(Region=="SAN MARTIN", "BAJAN", ifelse(Region=="TACNA","BAJAN", ifelse(Region=="PUNO", "BAJAN", "SUBEN")))))))))))))))) %>% 
    mutate(Macrozona= ifelse(Region=="AMAZONAS"|Region=="LORETO"|Region=="SAN MARTIN"|Region=="UCAYALI", "ORIENTE", ifelse(Region=="APURIMAC"|Region=="AREQUIPA"|Region=="CUSCO"|Region=="MADRE DE DIOS"|Region=="MOQUEGUA"|Region=="PUNO"|Region=="TACNA", "SUR", ifelse(Region=="CAJAMARCA"|Region=="LA LIBERTAD"|Region=="LAMBAYEQUE"|Region=="PIURA"|Region=="TUMBES", "NORTE", ifelse(Region=="CALLAO"|Region=="LIMA", "LIMA METROPOLITANA Y LIMA PROVINCIAS", "CENTRO")))))


```
```{r,echo=FALSE,warning=FALSE,message=FALSE}
distrito_mito2$Region[distrito_mito2$Provincia == 'LIMA'] <- 'LIMA METROPOLITANA'
```


```{r,echo=FALSE,warning=FALSE,message=FALSE}
distrito_mito3=distrito_mito2%>% 
  group_by(Region,Eleccion)%>%
  summarize_at(c('Electores','V_emitidos','V_validos'),sum)%>%
mutate(V_participacion=V_emitidos/Electores)%>%
  mutate(grupo= ifelse(Region=="AMAZONAS", "BAJAN", ifelse(Region=="AREQUIPA", "BAJAN", ifelse(Region=="APURIMAC", "BAJAN", ifelse(Region=="CAJAMARCA", "BAJAN", ifelse(Region=="CALLAO", "BAJAN", ifelse(Region=="CUSCO", "BAJAN", ifelse(Region=="LA LIBERTAD", "BAJAN", ifelse( Region=="LIMA", "BAJAN", ifelse(Region=="LORETO", "BAJAN", ifelse(Region=="MADRE DE DIOS", "BAJAN", ifelse(Region=="MOQUEGUA", "BAJAN", ifelse(Region=="PIURA", "BAJAN", ifelse(Region=="SAN MARTIN", "BAJAN", ifelse(Region=="TACNA","BAJAN", ifelse(Region=="PUNO", "BAJAN", "SUBEN")))))))))))))))) %>% 
    mutate(Macrozona= ifelse(Region=="AMAZONAS"|Region=="LORETO"|Region=="SAN MARTIN"|Region=="UCAYALI", "ORIENTE", ifelse(Region=="APURIMAC"|Region=="AREQUIPA"|Region=="CUSCO"|Region=="MADRE DE DIOS"|Region=="MOQUEGUA"|Region=="PUNO"|Region=="TACNA", "SUR", ifelse(Region=="CAJAMARCA"|Region=="LA LIBERTAD"|Region=="LAMBAYEQUE"|Region=="PIURA"|Region=="TUMBES", "NORTE", ifelse(Region=="CALLAO"|Region=="LIMA"|Region=="LIMA METROPOLITANA", "LIMA METROPOLITANA Y LIMA PROVINCIAS", "CENTRO")))))
```


```{r,echo=FALSE,warning=FALSE,message=FALSE}
distrito_mito3$Eleccion= as.factor(str_sub(distrito_mito3$Eleccion,10,15))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
region_mito2a=distrito_mito3 %>%
 filter(Macrozona=="CENTRO")

region_mito2b=distrito_mito3 %>%
 filter(Macrozona=="LIMA METROPOLITANA Y LIMA PROVINCIAS")

region_mito2c=distrito_mito3 %>%
 filter(Macrozona=="NORTE")

region_mito2d=distrito_mito3 %>%
 filter(Macrozona=="ORIENTE")

region_mito2e=distrito_mito3 %>%
 filter(Macrozona=="SUR")
```


```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = region_mito2a, aes(x = Eleccion, y = V_participacion, group = Region)) + 
  geom_line(aes(color = grupo), show.legend = FALSE) + 
  geom_point(size = 0.5, shape = 21)+
  facet_wrap(~Region, ncol = 3)+
  xlab("Elección")+ 
  ylab("Porcentaje")+theme_minimal()+
scale_color_manual(values =  c("#156c99"))+
  theme(axis.text = element_text(size=7))+
  ggtitle("Porcentaje de Participación Electoral por región \nMacrozona Centro")+
  theme(legend.text = element_text(colour="black", size=6)) + 
  theme(legend.title = element_text(color = "black", size = 7))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0.6,1))+
  geom_text(aes(label=paste0(round(V_participacion*100,1),"%"),vjust=-.9),size=1.8)+
  theme(plot.title = element_text(hjust = 0.5))
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = region_mito2c, aes(x = Eleccion, y = V_participacion, group = Region)) + 
  geom_line(aes(), show.legend = FALSE) + 
  geom_point(size = 0.5, shape = 21)+
  facet_wrap(~Region, ncol = 3)+
  xlab("Elección")+ 
  ylab("Porcentaje")+theme_minimal()+
scale_color_manual(values =  c("#156c99"))+
  theme(axis.text = element_text(size=7))+
  ggtitle("Porcentaje de Participación Electoral por región \nMacrozona Norte")+
  theme(legend.text = element_text(colour="black", size=6)) + 
  theme(legend.title = element_text(color = "black", size = 7))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0.6,1))+
  geom_text(aes(label=paste0(round(V_participacion*100,1),"%"),vjust=-.9),size=1.8)+
  theme(plot.title = element_text(hjust = 0.5))
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = region_mito2b, aes(x = Eleccion, y = V_participacion, group = Region)) + 
  geom_line(aes(), show.legend = FALSE) + 
  geom_point(size = 0.5, shape = 21)+
  facet_wrap(~Region, ncol = 3)+
  xlab("Elección")+ 
  ylab("Porcentaje")+theme_minimal()+
scale_color_manual(values =  c("#156c99"))+
  theme(axis.text = element_text(size=7))+
  ggtitle("Porcentaje de Participación Electoral por región \nMacrozona Lima Metropolitana y Lima Provincias")+
  theme(legend.text = element_text(colour="black", size=6)) + 
  theme(legend.title = element_text(color = "black", size = 7))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0.6,1))+
  geom_text(aes(label=paste0(round(V_participacion*100,1),"%"),vjust=-.9),size=1.8)+
  theme(plot.title = element_text(hjust = 0.5))
```





```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = region_mito2d, aes(x = Eleccion, y = V_participacion, group = Region)) + 
  geom_line(aes(), show.legend = FALSE) + 
  geom_point(size = 0.5, shape = 21)+
  facet_wrap(~Region, ncol = 3)+
  xlab("Elección")+ 
  ylab("Porcentaje")+theme_minimal()+
scale_color_manual(values =  c("#156c99"))+
  theme(axis.text = element_text(size=7))+
  ggtitle("Porcentaje de Participación Electoral por región \nMacrozona Oriente")+
  theme(legend.text = element_text(colour="black", size=6)) + 
  theme(legend.title = element_text(color = "black", size = 7))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0.6,1))+
  geom_text(aes(label=paste0(round(V_participacion*100,1),"%"),vjust=-.9),size=1.8)+
  theme(plot.title = element_text(hjust = 0.5))
```


```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = region_mito2e, aes(x = Eleccion, y = V_participacion, group = Region)) + 
  geom_line(aes(), show.legend = FALSE) + 
  geom_point(size = 0.5, shape = 21)+
  facet_wrap(~Region, ncol = 3)+
  xlab("Elección")+ 
  ylab("Porcentaje")+theme_minimal()+
scale_color_manual(values =  c("#156c99"))+
  theme(axis.text = element_text(size=7))+
  ggtitle("Porcentaje de Participación Electoral por región \nMacrozona Sur")+
  theme(legend.text = element_text(colour="black", size=6)) + 
  theme(legend.title = element_text(color = "black", size = 7))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0.6,1))+
  geom_text(aes(label=paste0(round(V_participacion*100,1),"%"),vjust=-.9),size=1.8)+
  theme(plot.title = element_text(hjust = 0.5))
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
distrito_mito2_1=distrito_mito3%>%
  group_by(Macrozona,Eleccion)%>%
  summarize_at(c('Electores','V_emitidos','V_validos'),sum)%>%
mutate(V_participacion=V_emitidos/Electores)
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
distrito_mito2_1$Macrozona[distrito_mito2_1$Macrozona == 'LIMA METROPOLITANA Y LIMA PROVINCIAS'] <- 'LIMA Y CALLAO'
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = distrito_mito2_1, aes(x = Eleccion, y = V_participacion, group = Macrozona)) + 
  geom_line(aes(), show.legend = FALSE) + 
  geom_point(size = 0.5, shape = 21)+
  facet_wrap(~Macrozona, ncol = 3)+
  xlab("Elección")+ 
  ylab("Porcentaje")+theme_minimal()+
scale_color_manual(values =  c("#156c99"))+
  theme(axis.text = element_text(size=7))+
  ggtitle("Porcentaje de Participación Electoral por región \nMacrozonas")+
  theme(legend.text = element_text(colour="black", size=6)) + 
  theme(legend.title = element_text(color = "black", size = 7))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0.6,1))+
  geom_text(aes(label=paste0(round(V_participacion*100,1),"%"),vjust=-.9),size=1.8)+
  theme(plot.title = element_text(hjust = 0.5))
```
```{r,echo=FALSE,warning=FALSE,message=FALSE}
rm(distrital,region_mito2a,region_mito2b,region_mito2c,region_mito2d,region_mito2e)
```

## Mapa a nivel regional

<font size="5"> **Mapa de la Participación Electoral 2022 a nivel regional**</font>


```{r,echo=FALSE,warning=FALSE,message=FALSE}
part_mapas=distrito_mito3%>%filter(Eleccion==' 2022')
part_mapas$nombres=c("Amazonas","Ancash","Apurímac","Arequipa","Ayacucho","Cajamarca","Callao","Cusco","Huancavelica","Huánuco","Ica","Junín","La Libertad","Lambayeque","Lima","Lima Province","Loreto","Madre de Dios","Moquegua","Pasco","Piura","Puno","San Martín","Tacna","Tumbes","Ucayali")
part_mapas$V_participacion=round(part_mapas$V_participacion*100,1)
part_mapas=part_mapas%>%dplyr::rename(c('% de participación electoral'="V_participacion"))
```



```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(raster)
per_r=getData("GADM", country= "PER", level=1)

geo2=merge(per_r,part_mapas, by.x="NAME_1",by.y="nombres", duplicateGeoms = TRUE)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
 library(tmap)
 tmap_mode("view")
 tm_shape(geo2) +
   tm_polygons(
     id="Region",
     col = "% de participación electoral" ,
     breaks = c(0,60.1,65.1,70.1,75.1,80.1,85.1,Inf),
     pal = "BuPu" ,
     title = "Porcentaje de Participación Electoral",
     labels=c("0-60%","60-65%","65-70%","70-75","75-80","80-85","Más de 85")
     ) +
   tm_view(view.legend.position = c("left","bottom"))+
      tm_layout(legend.format = list(text.separator = "-"))
```

## Mapa a nivel provincial

<font size="5"> **Mapa de la Participación Electoral 2022 a nivel provincial**</font>

```{r,echo=FALSE,warning=FALSE,message=FALSE}
provincial=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQUlZR5ccTPZzM1Uleflp7gomwKqGI3PCo4DijVl42CXoGl2WwVv7HBr0GJffWILL5b0nwkpP2XfPVF/pub?gid=2059395285&single=true&output=csv", dec = ".")
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(dplyr)
library(tidyverse)
library(car)
provincial_mito1 =provincial%>% 
  filter(Eleccion=="Provincial 2022")%>%
  dplyr::select(Region,Provincia,UBIGEO,V_emitidos,V_validos,Electores,Eleccion)%>%
  unique()

provincial_mito1$Eleccion=as.factor(provincial_mito1$Eleccion)
provincial_mito1$'% de participación electoral'=round(provincial_mito1$V_emitidos/provincial_mito1$Electores*100,1)

```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial_mito1$UBIGEO=ifelse(99<provincial_mito1$UBIGEO&provincial_mito1$UBIGEO<1000,paste(0,provincial_mito1$UBIGEO, sep = ""), provincial_mito1$UBIGEO)

```


```{r include=FALSE}
library(rgdal)
mapprov=readOGR("PROVINCIAS.shp") 
geoprov22=merge(mapprov,provincial_mito1,by.x="IDPROV",by.y="UBIGEO", all.x=T)
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
rm(provincial,provincial_mito1)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
tmap_mode("view")
tm_shape(geoprov22) +
  tm_polygons(
    id="Provincia",
    col = "% de participación electoral",
    breaks = c(0,60.1,65.1,70.1,75.1,80.1,85.1,Inf),
    pal = "BuPu" ,
    title = "Porcentaje de Participación Electoral",
    labels=c("0-60%","60-65%","65-70%","70-75","75-80","80-85","Más de 85")
    ) +
  #tm_facets(by = "Eleccion", ncol = 1) +
  tm_view(view.legend.position = c("left","bottom"))+
  tmap_options(check.and.fix = TRUE)
```


## Mapa a nivel distrital

<font size="5"> **Mapa de la Participación Electoral 2022 a nivel distrital**</font>

```{r, echo=FALSE,warning=FALSE,message=FALSE}
rm(list=ls())
```



```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(googlesheets4)
distrital=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQMLHdXuz-ykbp9VmJJGhtl0vdNeeMxjgod2YrYLt9UB3RdX8tb-LEbZr2PVV41Sj384LuK1quysfNj/pub?gid=30541803&single=true&output=csv",dec=".")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito1 =distrital%>% 
  filter(Eleccion=="Distrital 2022")%>%
  dplyr::select(Region,Provincia,Distrito, UBIGEO,V_emitidos,V_validos,Electores,Eleccion)%>%
  unique()
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito1$'% de participación electoral'=round(distrital_mito1$V_emitidos/distrital_mito1$Electores*100,1)
```



```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito1$UBIGEO=ifelse(9999<distrital_mito1$UBIGEO&distrital_mito1$UBIGEO<100000,paste(0,distrital_mito1$UBIGEO, sep = ""), distrital_mito1$UBIGEO)

```

```{r include=FALSE}
mapdist=readOGR("LIMITE_DISTRITAL_2020_INEI.shp") 
geodist22=merge(mapdist,distrital_mito1,by.x="UBIGEO",by.y="UBIGEO", duplicateGeoms = TRUE)
#geodist22=geodist22[complete.cases(geodist22@data$`% de votos no válidos`),] 
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
tmap_mode("view")
tm_shape(geodist22) +
  tm_polygons(
    id="NOMBDIST",
    col = "% de participación electoral",
    breaks = c(0,60.1,65.1,70.1,75.1,80.1,85.1,Inf),
    pal = "BuPu" ,
    colorNA = "white",
    textNA = "Distrito capital sin elección",
    title = "Porcentaje de participación electoral",
    labels=c("0-60%","60-65%","65-70%","70-75","75-80","80-85","Más de 85")
    ) +
  #tm_facets(by = "Eleccion", ncol = 1)+
  tm_view(view.legend.position = c("left","bottom"))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
rm(list=ls())
```

<!--chapter:end:01-participación-electoral.Rmd-->

# El voto no válido 

<font size="6"> **El porcentaje del voto de protesta ha aumentado ¿verdadero o falso?**</font>

```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(dplyr)
library(ggplot2)
library(rio)
regional=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vRJdUE26KIgGmrUT8DEUzY5f3JsGlK0-eQdoTeWQw2SPrGpA_bI54jpSDnyE-hBBAoIsBRiAJzoghy-/pub?gid=2080689295&single=true&output=csv", dec = ".")
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(stringr)
library(dplyr)
reg_mito2=regional %>%
   filter(Vuelta=="Primera")%>%
  filter(Eleccion=="Regional 2002"|Eleccion=="Regional 2006"|Eleccion=="Regional 2010"|Eleccion=="Regional 2014"|Eleccion=="Regional 2018"|Eleccion=="Regional 2022")%>%
  select(Region,V_emitidos,V_validos,Eleccion)%>%
  unique()%>%
  group_by(Eleccion)%>%
  summarise(V_emitidos_t=sum(V_emitidos),
            V_validos_t=sum(V_validos))%>%
  mutate(V_novalidos=V_emitidos_t-V_validos_t) %>%
  mutate(V_novalidos_p=(V_novalidos/V_emitidos_t))%>%
  mutate(Tipo="Regional")
reg_mito2$Eleccion= as.factor(str_sub(reg_mito2$Eleccion,10,13))
```


```{r,echo=FALSE,warning=FALSE,message=FALSE}
provincial=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQUlZR5ccTPZzM1Uleflp7gomwKqGI3PCo4DijVl42CXoGl2WwVv7HBr0GJffWILL5b0nwkpP2XfPVF/pub?gid=2059395285&single=true&output=csv", dec = ".")
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
prov_mito2 =provincial%>% 
  select(Provincia,V_emitidos,V_validos,Eleccion)%>%
  unique()%>%
  group_by(Eleccion)%>%
  summarise(V_emitidos_t=sum(V_emitidos), V_validos_t=sum(V_validos))%>%
  mutate(V_novalidos=V_emitidos_t-V_validos_t)%>%
  mutate(V_novalidos_p=(V_novalidos/V_emitidos_t)) %>% 
  mutate(Tipo="Provincial")
prov_mito2$Eleccion= as.factor(str_sub(prov_mito2$Eleccion,12,15))
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
distrital=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQMLHdXuz-ykbp9VmJJGhtl0vdNeeMxjgod2YrYLt9UB3RdX8tb-LEbZr2PVV41Sj384LuK1quysfNj/pub?gid=30541803&single=true&output=csv",dec=".")
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
dist_mito2=distrital%>% 
  select(Region,Provincia,Distrito,V_emitidos,V_validos,Eleccion)%>%
  unique()%>%
  group_by(Eleccion)%>%
  summarise(V_emitidos_t=sum(V_emitidos), V_validos_t=sum(V_validos))%>%
  mutate(V_novalidos=V_emitidos_t-V_validos_t)%>%
  mutate(V_novalidos_p=V_novalidos/V_emitidos_t) %>% 
  mutate(Tipo="Distrital")
dist_mito2$Eleccion= as.factor(str_sub(dist_mito2$Eleccion,11,14))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
mito2=rbind(reg_mito2, prov_mito2, dist_mito2) 
```

```{r,  echo=FALSE,warning=FALSE,message=FALSE}
library(ggrepel)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(mito2, aes(x=Eleccion, y=V_novalidos_p, group=Tipo, color = Tipo))+
  geom_line()+
  geom_point()+
  geom_text_repel(aes(label=paste0(round(V_novalidos_p*100,1),"%"),vjust=-.9), colour="black")+
  ggtitle("Porcentaje de Votos no válidos \nen Elecciones Regionales y Municipales (2002-2022)", subtitle = "Votos no válidos = votos en blanco + votos nulos")+
  xlab("Proceso Electoral")+
  ylab("Porcentaje de Votos no válidos")+
  scale_color_manual(values = c("#C18B3D", "#E55555", "#156C99"), labels = c("Elección Distrital", "Elección Provincial", "Elección Regional"))+
  labs(color = "")+
  theme_minimal()+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1),limit=c(0.05,0.25))+
  theme(plot.title = element_text(hjust = 0.5),plot.subtitle = element_text(hjust = 0.5))+
  theme(legend.position = "top")+
  theme(legend.text = element_text(colour="black", size=9))

#ggsave("2_general.png")
```

## Elecciones Regionales

**Voto no válido en Elecciones Regionales**

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(reg_mito2, aes(x=Eleccion, y=V_novalidos_p, group=1)) +
  geom_line(colour = "#156C99")+
  geom_point(colour = "#156C99")+
  xlab("Proceso Electoral")+
  ylab("Porcentaje de Votos no válidos")+ 
  ggtitle("Porcentaje de Votos no válidos en Elecciones Regionales", subtitle = "Votos no válidos = votos en blanco + votos nulos")+  theme_minimal() + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0,0.25))+
  geom_text(aes(label=paste0(round(V_novalidos_p*100,1),"%"),vjust=-.9))+
  theme(plot.title = element_text(hjust = 0.5),plot.subtitle = element_text(hjust = 0.5)) 

#ggsave("2_regional.png")
```

**Porcentaje de Voto no válido según región**

```{r,echo=FALSE,warning=FALSE,message=FALSE}
region_mito2 =regional%>% 
  filter(Vuelta=="Primera")%>%
  filter(Eleccion=="Regional 2002"|Eleccion=="Regional 2006"|Eleccion=="Regional 2010"|Eleccion=="Regional 2014"|Eleccion=="Regional 2018"|Eleccion=="Regional 2022")%>%
  select(Region,V_emitidos,V_validos,Eleccion)%>%
  unique()%>%
  mutate(V_novalidos=V_emitidos-V_validos)%>%
  mutate(V_novalidos_p=(V_novalidos/V_emitidos)) %>%
  mutate(grupo= ifelse(Region=="AMAZONAS", "BAJAN", ifelse(Region=="AREQUIPA", "BAJAN", ifelse(Region=="APURIMAC", "BAJAN", ifelse(Region=="CAJAMARCA", "BAJAN", ifelse(Region=="CALLAO", "BAJAN", ifelse(Region=="CUSCO", "BAJAN", ifelse(Region=="LA LIBERTAD", "BAJAN", ifelse( Region=="LIMA", "BAJAN", ifelse(Region=="LORETO", "BAJAN", ifelse(Region=="MADRE DE DIOS", "BAJAN", ifelse(Region=="MOQUEGUA", "BAJAN", ifelse(Region=="PIURA", "BAJAN", ifelse(Region=="SAN MARTIN", "BAJAN", ifelse(Region=="TACNA","BAJAN", ifelse(Region=="PUNO", "BAJAN", "SUBEN")))))))))))))))) %>% 
    mutate(Macrozona= ifelse(Region=="AMAZONAS"|Region=="LORETO"|Region=="SAN MARTIN"|Region=="UCAYALI", "ORIENTE", ifelse(Region=="APURIMAC"|Region=="AREQUIPA"|Region=="CUSCO"|Region=="MADRE DE DIOS"|Region=="MOQUEGUA"|Region=="PUNO"|Region=="TACNA", "SUR", ifelse(Region=="CAJAMARCA"|Region=="LA LIBERTAD"|Region=="LAMBAYEQUE"|Region=="PIURA"|Region=="TUMBES", "NORTE", ifelse(Region=="CALLAO"|Region=="LIMA", "LIMA Y CALLAO", "CENTRO")))))

region_mito2$Eleccion= as.factor(str_sub(region_mito2$Eleccion,10,13))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
region_mito2a=region_mito2 %>%
 filter(Macrozona=="CENTRO")

region_mito2b=region_mito2 %>%
 filter(Macrozona=="LIMA Y CALLAO")

region_mito2c=region_mito2 %>%
 filter(Macrozona=="NORTE")

region_mito2d=region_mito2 %>%
 filter(Macrozona=="ORIENTE")

region_mito2e=region_mito2 %>%
 filter(Macrozona=="SUR")
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = region_mito2a, aes(x = Eleccion, y = V_novalidos_p, group = Region)) + 
  geom_line(aes(color = grupo), show.legend = TRUE) + 
  geom_point(size = 0.5)+
  facet_wrap(~Region, ncol = 3)+
  xlab("Elección")+ 
  ylab("Porcentaje")+theme_minimal()+
  scale_color_manual(values =  c("#E55555"), labels = c("Ascenso de votos no válidos al 2022"))+
  labs(color = "")+
  theme(legend.position = "top")+
  theme(axis.text = element_text(size=7))+
  ggtitle("Porcentaje de Votos no válidos en Elecciones Regionales por región \nMacrozona Centro")+
  theme(legend.text = element_text(colour="black", size=9)) + 
  theme(legend.title = element_text(color = "black", size = 9))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0,0.4))+
  geom_text(aes(label=paste0(round(V_novalidos_p*100,1),"%"),vjust=-.9),size=2.5)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("2_regionalA.png")
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = region_mito2b, aes(x = Eleccion, y = V_novalidos_p, group = Region)) + 
  geom_line(aes(color = grupo), show.legend = TRUE) + 
  geom_point(size = 1)+
  facet_wrap(~Region, ncol = 2)+
  xlab("Elección")+ 
  ylab("Porcentaje")+theme_minimal()+
  scale_color_manual(values =  c("#156C99"), labels = c("Descenso de votos no válidos al 2022"))+
  labs(color = "")+
  theme(legend.position = "top")+
  theme(axis.text = element_text(size=9))+
  ggtitle("Porcentaje de Votos no válidos en Elecciones Regionales por región \nMacrozona Lima y Callao")+
  theme(legend.text = element_text(colour="black", size=9)) + 
  theme(legend.title = element_text(color = "black", size = 9))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0,0.4))+
  geom_text(aes(label=paste0(round(V_novalidos_p*100,1),"%"),vjust=-.9), size=3)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("2_regionalB.png")
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = region_mito2c, aes(x = Eleccion, y = V_novalidos_p, group = Region)) + 
  geom_line(aes(color = grupo), show.legend = TRUE) + 
  geom_point(size = 0.5)+
  facet_wrap(~Region, ncol = 3)+
  xlab("Elección")+ 
  ylab("Porcentaje")+theme_minimal()+
  scale_color_manual(values =  c("#156C99","#E55555"), labels = c("Descenso de votos no válidos al 2022","Ascenso de votos no válidos al 2022"))+
  labs(color = "")+
  theme(legend.position = "top")+
  theme(axis.text = element_text(size=7))+
  ggtitle("Porcentaje de Votos no válidos en Elecciones Regionales por región \nMacrozona Norte")+
  theme(legend.text = element_text(colour="black", size=9)) + 
  theme(legend.title = element_text(color = "black", size = 7))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0,0.4))+
  geom_text(aes(label=paste0(round(V_novalidos_p*100,1),"%"),vjust=-.9),size=2.5)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("2_regionalC.png")
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = region_mito2d, aes(x = Eleccion, y = V_novalidos_p, group = Region)) + 
  geom_line(aes(color = grupo), show.legend = TRUE) + 
  geom_point(size = 0.5)+
  facet_wrap(~Region, ncol = 2)+
  xlab("Elección")+ 
  ylab("Porcentaje")+theme_minimal()+
  scale_color_manual(values =  c("#156C99","#E55555"), labels = c("Descenso de votos no válidos al 2022","Ascenso de votos no válidos al 2022"))+
  labs(color = "")+
  theme(legend.position = "top")+
  theme(axis.text = element_text(size=7))+
  ggtitle("Porcentaje de Votos no válidos en Elecciones Regionales por región \nMacrozona Oriente")+
  theme(legend.text = element_text(colour="black", size=9)) + 
  theme(legend.title = element_text(color = "black", size = 7))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0,0.4))+
  geom_text(aes(label=paste0(round(V_novalidos_p*100,1),"%"),vjust=-.9),size=2.5)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("2_regionalD.png")
```
  
```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = region_mito2e, aes(x = Eleccion, y = V_novalidos_p, group = Region)) + 
  geom_line(aes(color = grupo), show.legend = TRUE) + 
  geom_point(size = 0.5)+
  facet_wrap(~Region, ncol = 3)+
  xlab("Elección")+ 
  ylab("Porcentaje")+theme_minimal()+
  scale_color_manual(values =  c("#156C99"), labels = c("Descenso de votos no válidos al 2022"))+
  labs(color = "")+
  theme(legend.position = "top")+
  theme(axis.text = element_text(size=7))+
  ggtitle("Porcentaje de Votos no válidos en Elecciones Regionales por región \nMacrozona Sur")+
  theme(legend.text = element_text(colour="black", size=9)) + 
  theme(legend.title = element_text(color = "black", size = 7))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0,0.4))+
  geom_text(aes(label=paste0(round(V_novalidos_p*100,1),"%"),vjust=-.9),size=2.5)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("2_regionalE.png")
```


**Porcentaje de votos no válidos versus Porcentaje de votos por la organización política ganadora en las Elecciones Regionales**

```{r,echo=FALSE,warning=FALSE,message=FALSE}
region_mito2_comp=regional%>% 
  filter(Vuelta=="Primera")%>%
  filter(Eleccion=="Regional 2002"|Eleccion=="Regional 2006"|Eleccion=="Regional 2010"|Eleccion=="Regional 2014"|Eleccion=="Regional 2018"|Eleccion=="Regional 2022")%>%
  filter(!(Org_pol %in% c("VOTOS EN BLANCO","VOTOS NULOS")))%>%
  select(Region,V_emitidos,V_validos,Org_pol, Votos, Eleccion, UBIGEO)%>%
  group_by(Region,Eleccion, UBIGEO)%>%
  filter (Votos == max (Votos, na.rm = TRUE))%>%
  mutate(V_novalidos = V_emitidos-V_validos)%>%
  mutate(V_novalidos_p=V_novalidos/V_emitidos) %>%
  mutate(Comparacion = ifelse(Votos>V_novalidos, "1_ORGANIZACION POLITICA", ifelse(Votos<V_novalidos, "2_NO VALIDOS", "3_EMPATE")))

region_mito2_comp$Eleccion= as.factor(str_sub(region_mito2_comp$Eleccion,10,13))
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
region_mito2_compara =region_mito2_comp %>%
  group_by(Eleccion)%>%
  count(Comparacion) %>%
  mutate(ratio=scales::percent(n/sum(n),accuracy = 1))
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(region_mito2_compara, aes(x = Eleccion, y=n, fill = Comparacion)) + 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold")+
  ggtitle("Porcentaje de regiones donde el voto no valido supera \nal voto de la organización política ganadora")+
  xlab("Elección Regional")+ 
  ylab("Regiones (%)")+
  scale_fill_manual(values = c("#156C99","#E55555"), labels = c("Organización política","Votos no válidos")) + 
  labs(fill = "Mayor cantidad de votos obtenidos por")+theme_minimal()+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("2_regional_versus.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
#export(region_mito2_comp,"region_mito2_comp.xlsx")
```

**Mapa Voto no válido en Elecciones Regionales 2022**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
region_m2=region_mito2_comp %>% 
  select(Region, Eleccion, UBIGEO, V_novalidos_p, Comparacion) %>% 
  mutate(V_novalidos_p=round(V_novalidos_p*100,1)) %>% 
  rename(c('% de votos no válidos'="V_novalidos_p"))

region_m2$UBIGEO=ifelse(region_m2$UBIGEO<10,paste(0,region_m2$UBIGEO, sep = ""), region_m2$UBIGEO)
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
region_m2_2022=region_m2 %>% 
  filter(Eleccion=="2022")
```

```{r include=FALSE}
library(raster)
per_r=getData("GADM", country= "PER", level=1)
per_r=subset(per_r, NAME_1!="Lima Province" )
georeg22=merge(per_r,region_m2_2022,by.x="CC_1",by.y="UBIGEO", duplicateGeoms = TRUE)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
library(tmap)
tmap_mode("view")
tm_shape(georeg22) +
  tm_polygons(
    id="Region",
    col = "% de votos no válidos",
    breaks = c(14.5, 17.1, 18.6, 20.1,21.6,Inf),
    pal = "Reds" ,
    title = "Porcentaje de votos no válidos",
    labels=c("14.5-17%","17-18.5%","18.5-20%","20-21.5%","Más de 21.5%")
    ) +
  #tm_facets(by = "Eleccion", ncol = 1) +
  tm_view(view.legend.position = c("left","bottom"))
```

```{r}
rm(region_m2_2022,regional,per_r,region_m2)
```


## Elecciones Provinciales

**Voto no válido en Elecciones Provinciales**

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(prov_mito2, aes(x=Eleccion, y=V_novalidos_p, group=1)) +
  geom_line(colour = "#E55555")+
  geom_point(colour = "#E55555")+
  ggtitle("Porcentaje de Votos no válidos en Elecciones Provinciales",  subtitle = "Votos no válidos = votos en blanco + votos nulos")+
  xlab("Proceso Electoral")+ 
  ylab("Porcentaje de Votos no válidos")+theme_minimal()+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0,0.25))+
  geom_text(aes(label=paste0(round(V_novalidos_p*100,1),"%"),vjust=-.9))+
  theme(plot.title = element_text(hjust = 0.5),plot.subtitle = element_text(hjust = 0.5)) 

#ggsave("2_provincial.png")
```

**Porcentaje de votos no válidos versus Porcentaje de votos por la organización política ganadora en las Elecciones Provinciales**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
prov_mito2_comp =provincial%>% 
  dplyr::select(Region,Provincia,V_emitidos,V_validos,Org_pol, Votos, Eleccion, UBIGEO)%>%
  filter(Org_pol != "VOTOS EN BLANCO" & Org_pol != "VOTOS NULOS")%>%
  group_by(Region, Provincia,Eleccion)%>%
  slice (which.max (Votos))%>%   #por si hay empates   filter (Votos == max (Votos, na.rm = TRUE))%>% incluye empate
  mutate(V_novalidos=V_emitidos-V_validos)%>%
  mutate(V_novalidos_p=V_novalidos/V_emitidos) %>% 
  mutate(Comparacion= ifelse(Votos>V_novalidos, "1_ORGANIZACION POLITICA", ifelse(Votos<V_novalidos, "2_NO VALIDOS", "3_EMPATE")))

prov_mito2_comp$Eleccion= as.factor(str_sub(prov_mito2_comp$Eleccion,12,15))
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
prov_mito2_compara =prov_mito2_comp %>%
  group_by(Eleccion) %>% 
  count(Comparacion) %>%
  mutate(ratio=scales::percent(n/sum(n),accuracy = 1))
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(prov_mito2_compara, aes(x = Eleccion, y=n, fill = Comparacion)) + 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold")+
  ggtitle("Porcentaje de provincias donde el voto no valido supera \nal voto de la organización política ganadora")+
  xlab("Elección Provincial")+ 
  ylab("Regiones (%)")+
  scale_fill_manual(values = c("#156C99","#E55555"), labels = c("Organización política","Votos no válidos")) + 
  labs(fill = "Mayor cantidad de votos obtenidos por")+theme_minimal()+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("2_provincial_versus.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
#export(prov_mito2_comp,"prov_mito2_comp.xlsx")
```

**Mapa Voto no válido en Elecciones Provinciales 2022**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
prov_m2=prov_mito2_comp %>% 
  dplyr::select(Provincia, Eleccion, UBIGEO, V_novalidos_p, Comparacion) %>% 
  mutate(V_novalidos_p=round(V_novalidos_p*100,1)) %>% 
  rename(c('% de votos no válidos'="V_novalidos_p"))

prov_m2$UBIGEO=ifelse(99<prov_m2$UBIGEO&prov_m2$UBIGEO<1000,paste(0,prov_m2$UBIGEO, sep = ""), prov_m2$UBIGEO)
#prov_m2$ubi_reg=substr(prov$UBIGEO, 1, 2) 
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
prov_m2_2022=prov_m2 %>% 
  filter(Eleccion=="2022")
```

```{r include=FALSE}
library(rgdal)
mapprov=readOGR("PROVINCIAS.shp") 
geoprov22=merge(mapprov,prov_m2_2022,by.x="IDPROV",by.y="UBIGEO", all.x=T)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
tmap_mode("view")
tm_shape(geoprov22) +
  tm_polygons(
    id="Provincia",
    col = "% de votos no válidos",
    breaks = c(6,10.1,14.1,18.1,22.1,Inf),
    pal = "Reds" ,
    title = "Porcentaje de votos no válidos",
    labels=c("6-10%","10-14%","14-18%","18-22%","Más de 22%")
    ) +
  #tm_facets(by = "Eleccion", ncol = 1) +
  tm_view(view.legend.position = c("left","bottom"))+
  tmap_options(check.and.fix = TRUE)
```

## Elecciones Distritales

**Voto no válido en Elecciones Distritales**

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(dist_mito2, aes(x=Eleccion, y=V_novalidos_p, group=1)) +
  geom_line(colour = "#C18B3D")+
  geom_point(colour = "#C18B3D")+
  ggtitle("Porcentaje de Votos no válidos en Elecciones Distritales",  subtitle = "Votos no válidos = votos en blanco + votos nulos")+
  xlab("Proceso Electoral")+ 
  ylab("Porcentaje de Votos no válidos")+theme_minimal()+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limit = c(0,0.25))+
  geom_text(aes(label=paste0(round(V_novalidos_p*100,1),"%"),vjust=-.9))+
  theme(plot.title = element_text(hjust = 0.5),plot.subtitle = element_text(hjust = 0.5)) 

#ggsave("2_distrital.png")
```

**Porcentaje de votos no válidos versus Porcentaje de votos por la organización política ganadora en las Elecciones Distritales**

```{r,echo=FALSE,warning=FALSE,message=FALSE}
dist_mito2_comp =distrital%>% 
  dplyr::select(Region,Provincia,Distrito,V_emitidos,V_validos,Org_pol, Votos, Eleccion, UBIGEO)%>%
  filter(Org_pol != "VOTOS EN BLANCO" & Org_pol != "VOTOS NULOS")%>%
  group_by(Provincia,Distrito,Eleccion)%>%
  slice (which.max (Votos))%>%
  mutate(V_novalidos=V_emitidos-V_validos)%>%
  mutate(V_novalidos_p=V_novalidos/V_emitidos) %>% 
  mutate(Comparacion= ifelse(Votos>V_novalidos, "1_ORGANIZACION", ifelse(Votos<V_novalidos, "2_NO VALIDOS", "3_EMPATE")))

dist_mito2_comp$Eleccion= as.factor(str_sub(dist_mito2_comp$Eleccion,11,14))
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
dist_mito2_compara =dist_mito2_comp %>%
  group_by(Eleccion) %>% 
  count(Comparacion) %>%
  mutate(ratio=scales::percent(n/sum(n),accuracy = 0.1))
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ggplot(dist_mito2_compara, aes(x = Eleccion, y=n, fill = Comparacion)) + 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold")+
  ggtitle("Porcentaje de distritos donde el voto no valido supera \nal voto de la organización política ganadora")+
  xlab("Elección Distrital")+ 
  ylab("Distritos (%)")+
  scale_fill_manual(values = c("#156C99","#E55555","#55BA77"), labels = c("Organización política","Votos no válidos","Empate")) + 
  labs(fill = "Mayor cantidad de votos obtenidos por")+theme_minimal()+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("2_distrital_versus.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
#export(dist_mito2_comp,"dist_mito2_comp.xlsx")
```

**Mapa Voto no válido en Elecciones Distritales 2022**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
dist_m2=dist_mito2_comp %>% 
  dplyr::select(Region,Provincia, Distrito,Eleccion, UBIGEO, V_novalidos_p, Comparacion) %>% 
  mutate(V_novalidos_p=round(V_novalidos_p*100,1)) %>% 
  rename(c('% de votos no válidos'="V_novalidos_p"))

dist_m2$UBIGEO=ifelse(10000<dist_m2$UBIGEO&dist_m2$UBIGEO<100000,paste(0,dist_m2$UBIGEO, sep = ""), dist_m2$UBIGEO)
#dist_m2$ubi_reg=substr(dist_m2$UBIGEO, 1, 2) 
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
dist_m2_2022=dist_m2 %>% 
  filter(Eleccion=="2022")
```

```{r include=FALSE}
mapdist=readOGR("LIMITE_DISTRITAL_2020_INEI.shp") 
geodist22=merge(mapdist,dist_m2_2022,by.x="UBIGEO",by.y="UBIGEO", duplicateGeoms = TRUE)
#geodist22=geodist22[complete.cases(geodist22@data$`% de votos no válidos`),] 
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
tmap_mode("view")
tm_shape(geodist22) +
  tm_polygons(
    id="NOMBDIST",
    col = "% de votos no válidos",
    breaks = c(0,5.1,10.1,15.1,20.1,Inf),
    pal = "Reds" ,
    colorNA = "white",
    textNA = "Distrito capital sin elección",
    title = "Porcentaje de votos no válidos",
    labels=c("0-5%","5-10%","10-15%","15-20%","Más de 20%")
    ) +
  #tm_facets(by = "Eleccion", ncol = 1)+
  tm_view(view.legend.position = c("left","bottom"))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
rm(list=ls())
```

<!--chapter:end:02-el-voto-no-válido.Rmd-->

# 0rganizaciones políticas candidatas

<font size="6"> **El número de organizaciones políticas candidatas aumenta en cada elección ¿verdadero o falso?**</font>

```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(googlesheets4)
regional=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vRJdUE26KIgGmrUT8DEUzY5f3JsGlK0-eQdoTeWQw2SPrGpA_bI54jpSDnyE-hBBAoIsBRiAJzoghy-/pub?gid=1313822542&single=true&output=csv",dec=".")
library(dplyr)
library(ggplot2)
library(rio)
library(car)
library(ggrepel)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
library(car)
regional$Tipo_OP<-recode(regional$Tipo_OP, "'PARTIDO POLÃ\u008dTICO'='PARTIDO POLITICO'")
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
provincial=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQUlZR5ccTPZzM1Uleflp7gomwKqGI3PCo4DijVl42CXoGl2WwVv7HBr0GJffWILL5b0nwkpP2XfPVF/pub?gid=2059395285&single=true&output=csv", dec = ".")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial$Tipo_OP<-recode(provincial$Tipo_OP, "'ORGANIZACIÃ“N LOCAL (PROVINCIAL)'='ORGANIZACION LOCAL PROVINCIAL'; 'PARTIDO POLÃ\u008dTICO'='PARTIDO POLITICO'")
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
distrital=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQMLHdXuz-ykbp9VmJJGhtl0vdNeeMxjgod2YrYLt9UB3RdX8tb-LEbZr2PVV41Sj384LuK1quysfNj/pub?output=csv", dec='.')
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital$Tipo_OP<-recode(distrital$Tipo_OP, "'ORGANIZACIÃ“N LOCAL (PROVINCIAL)'='ORGANIZACION LOCAL PROVINCIAL';'ORGANIZACION LOCAL (DISTRITAL)'='ORGANIZACION LOCAL DISTRITAL'; 'PARTIDO POLÃ\u008dTICO'='PARTIDO POLITICO'")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
reg=regional%>%
     dplyr::filter(Eleccion=="Regional 2002"|Eleccion=="Regional 2006"|Eleccion=="Regional 2010"|Eleccion=="Regional 2014"|Eleccion=="Regional 2018"|Eleccion=="Regional 2022")%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS" & Vuelta == "Primera")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP)

prov=provincial%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP) 

dist=distrital%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
library(car)
reg$Eleccion<-recode(reg$Eleccion, "'Regional 2002'='2002'; 'Regional 2006'='2006'; 'Regional 2010'='2010'; 'Regional 2014'='2014'; 'Regional 2018'='2018';'Regional 2022'='2022'")
prov$Eleccion<-recode(prov$Eleccion, "'Provincial 2002'='2002'; 'Provincial 2006'='2006'; 'Provincial 2010'='2010'; 'Provincial 2014'='2014'; 'Provincial 2018'='2018';'Provincial 2022'='2022'")
dist$Eleccion<-recode(dist$Eleccion, "'Distrital 2002'='2002'; 'Distrital 2006'='2006'; 'Distrital 2010'='2010'; 'Distrital 2014'='2014'; 'Distrital 2018'='2018';'Distrital 2022'='2022'")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
org_total=rbind(reg, prov, dist) 
org_total$Eleccion=as.factor(org_total$Eleccion)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
org_total_graf=org_total %>%
  unique() %>% 
  group_by(Eleccion,Tipo_OP) %>% 
  summarise(n=n())%>%
  mutate(ratio=scales::percent(n/sum(n), accuracy = 0.1)) %>% 
  mutate(n_por=n/sum(n))
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
#ggplot(org_total_graf, aes(x=Eleccion, y=n_por, group=Tipo_OP,color=Tipo_OP))+
 # geom_line()+
#  geom_point()+
 # geom_text_repel(aes(label=ratio,vjust=-.9), colour="black", size=3)+
#  ggtitle("Porcentaje de organizaciones políticas participantes \nen ERM según tipo de organización (2002-2022)")+
 # xlab("Proceso Electoral")+
#  ylab("Organizaciones políticas (%)")+
#  scale_color_manual(values = c("#55BA77","#06E3C3","#E55555","#122C74", "#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Distrital","Organización Local Provincial","Partido Político"))+
#  labs(color = "")+
#  theme_minimal()+
#  scale_y_continuous(labels = scales::percent_format(accuracy = 1),limit=c(0,1))+
#  theme(legend.text = element_text(colour="black", size=9))+
#  theme(legend.title = element_text(color = "black", size = 7))+
#  theme(plot.title = element_text(hjust = 0.5))+
#  theme(legend.position = "top")

#ggsave("3_general.png")
```

## Elecciones Regionales

**Número de organizaciones políticas en total**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
regional_mito3_total=regional%>%
     dplyr::filter(Eleccion=="Regional 2002"|Eleccion=="Regional 2006"|Eleccion=="Regional 2010"|Eleccion=="Regional 2014"|Eleccion=="Regional 2018"|Eleccion=="Regional 2022")%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS" & Vuelta == "Primera")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP) %>%
  unique%>%
  dplyr::group_by(Eleccion)%>% 
  summarise(n=n())
```

| **Elección**  | **Número de Org. Políticas** |
|:-------------:|:----------------------------:|
| Regional 2002 |              65              |
| Regional 2006 |             100              |
| Regional 2010 |             180              |
| Regional 2014 |             174              |
| Regional 2018 |             113              |
| Regional 2022 |              98              |




```{r, echo=FALSE,warning=FALSE,message=FALSE}
regional_mito3_region=regional%>%
     dplyr::filter(Eleccion=="Regional 2002"|Eleccion=="Regional 2006"|Eleccion=="Regional 2010"|Eleccion=="Regional 2014"|Eleccion=="Regional 2018"|Eleccion=="Regional 2022")%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS" & Vuelta == "Primera")%>%
  dplyr::select(Region,Org_pol,Tipo_OP,Eleccion,UBIGEO)%>%
  group_by(Region,Eleccion, Tipo_OP,UBIGEO)%>%
  summarise(n=n()) %>%
  group_by(Eleccion, Region)%>%
  mutate(total_org_pol = sum(n)) %>% 
  mutate(ratio=scales::percent(n/total_org_pol,accuracy = 0.1)) %>% 
  mutate(Macrozona= ifelse(Region=="AMAZONAS"|Region=="LORETO"|Region=="SAN MARTIN"|Region=="UCAYALI", "ORIENTE", ifelse(Region=="APURIMAC"|Region=="AREQUIPA"|Region=="CUSCO"|Region=="MADRE DE DIOS"|Region=="MOQUEGUA"|Region=="PUNO"|Region=="TACNA", "SUR", ifelse(Region=="CAJAMARCA"|Region=="LA LIBERTAD"|Region=="LAMBAYEQUE"|Region=="PIURA"|Region=="TUMBES", "NORTE", ifelse(Region=="CALLAO"|Region=="LIMA", "LIMA Y CALLAO", "CENTRO")))))
```


```{r, echo=FALSE,warning=FALSE,message=FALSE}
#PARA MAPA

library(reshape2)
regional_mito3_mapa=merge(x=dcast(regional_mito3_region, UBIGEO + Region + Eleccion + total_org_pol ~ Tipo_OP, value.var = "n"), y=dcast(regional_mito3_region, UBIGEO + Region + Eleccion ~ Tipo_OP, value.var = "ratio"), by= c("UBIGEO", "Region", "Eleccion"), all = TRUE)
regional_mito3_mapa[is.na(regional_mito3_mapa)] = 0
names(regional_mito3_mapa)[5]="alianza_n"
names(regional_mito3_mapa)[6]="mov_n"
names(regional_mito3_mapa)[7]="par_n"
names(regional_mito3_mapa)[8]="alianza_n_por"
names(regional_mito3_mapa)[9]="mov_n_por"
names(regional_mito3_mapa)[10]="par_n_por"

#export(regional_mito3_mapa,"regional_mito3_mapa.xlsx")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}

regional_mito3_mapa_a=dcast(regional_mito3_mapa,UBIGEO + Region  ~ Eleccion,value.var = "total_org_pol")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
names(regional_mito3_mapa_a)[3]="Número de organizaciones políticas candidatas 2002"
names(regional_mito3_mapa_a)[4]="Número de organizaciones políticas candidatas 2006"
names(regional_mito3_mapa_a)[5]="Número de organizaciones políticas candidatas 2010"
names(regional_mito3_mapa_a)[6]="Número de organizaciones políticas candidatas 2014"
names(regional_mito3_mapa_a)[7]="Número de organizaciones políticas candidatas 2018"
names(regional_mito3_mapa_a)[8]="Número de organizaciones políticas candidatas 2022"
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
regional_mito3_mapa_a$UBIGEO=ifelse(0<regional_mito3_mapa_a$UBIGEO&regional_mito3_mapa_a$UBIGEO<10,paste(0,regional_mito3_mapa_a$UBIGEO, sep = ""), regional_mito3_mapa_a$UBIGEO)

```

```{r,results='hide', echo=FALSE,warning=FALSE,message=FALSE}
library(raster)
per_r=getData("GADM", country= "PER", level=1)
per_r=subset(per_r, NAME_1!="Lima Province" )
georeg22=merge(per_r,regional_mito3_mapa_a,by.x="CC_1",by.y="UBIGEO", duplicateGeoms = TRUE)

```

<font size="5"> **Mapa del Número de Organizaciones Políticas Candidatas **</font>


```{r, echo=FALSE,warning=FALSE,message=FALSE}
library(tmap)
tmap_mode("view")
tm_shape(georeg22) +
  tm_polygons(
    id="Region",
    col = "Número de organizaciones políticas candidatas 2022",
    breaks = c(4, 8, 12,Inf),
    pal = "YlOrBr" ,
    popup.vars=c("Número de organizaciones políticas candidatas 2002","Número de organizaciones políticas candidatas 2006","Número de organizaciones políticas candidatas 2010","Número de organizaciones políticas candidatas 2014","Número de organizaciones políticas candidatas 2018","Número de organizaciones políticas candidatas 2018","Número de organizaciones políticas candidatas 2022"),
    title = "Número de organizaciones políticas candidatas 2022",
    labels=c("4-7","8-11","12 a más")
    ) +
  #tm_facets(by = "Eleccion", ncol = 1) +
  tm_view(view.legend.position = c("left","bottom"))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
rm(regional_mito3_mapa)
```


## Elecciones Provinciales

**Número de organizaciones políticas en total**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial_mito3_total=provincial%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP) %>%
  unique%>%
  dplyr::group_by(Eleccion)%>% 
  summarise(n=n())
```

|    **Elección**     | **Número de Org. Políticas** |
|:-------------------:|:----------------------------:|
| **Provincial 2002** |             425              |
| **Provincial 2006** |             246              |
| **Provincial 2010** |             254              |
| **Provincial 2014** |             239              |
| **Provincial 2018** |             132              |
| **Provincial 2022** |             125              |



```{r, echo=FALSE,warning=FALSE,message=FALSE}
##PARA MAPA: Número de org políticas por tipo y provincia

provincial_mito3_prov=provincial%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Region,Provincia, Org_pol,Tipo_OP,Eleccion,UBIGEO) %>%
  group_by(Region,Provincia,Eleccion, Tipo_OP,UBIGEO)%>%
  summarise(n=n()) %>% 
  group_by(Eleccion, Region, Provincia)%>%
  mutate(total_org_pol = sum(n)) %>% 
  mutate(ratio=scales::percent(n/total_org_pol,accuracy = 0.1))
```







```{r, echo=FALSE,warning=FALSE,message=FALSE}
##PARA MAPA: Número de org políticas por tipo y provincia

provincial_mito3_mapa=merge(x=dcast(provincial_mito3_prov, UBIGEO + Region + Provincia + Eleccion +total_org_pol ~ Tipo_OP, value.var = "n"), y=dcast(provincial_mito3_prov, UBIGEO + Region + Provincia + Eleccion + total_org_pol ~ Tipo_OP, value.var = "ratio"), by= c("UBIGEO", "Region", "Provincia", "Eleccion", "total_org_pol"), all = TRUE)
provincial_mito3_mapa[is.na(provincial_mito3_mapa)] = 0
names(provincial_mito3_mapa)[6]="alianza_n"
names(provincial_mito3_mapa)[7]="lista_n"
names(provincial_mito3_mapa)[8]="mov_n"
names(provincial_mito3_mapa)[9]="org_local_prov_n"
names(provincial_mito3_mapa)[10]="par_n"
names(provincial_mito3_mapa)[11]="alianza_n_por"
names(provincial_mito3_mapa)[12]="lista_n_por"
names(provincial_mito3_mapa)[13]="mov_n_por"
names(provincial_mito3_mapa)[14]="org_local_prov_n_por"
names(provincial_mito3_mapa)[15]="par_n_por"

#export(provincial_mito3_mapa,"provincial_mito3_mapa.xlsx")
```



```{r, echo=FALSE,warning=FALSE,message=FALSE}

provincial_mito3_mapa_a=dcast(provincial_mito3_mapa,UBIGEO + Region +Provincia ~ Eleccion,value.var = "total_org_pol")
```



```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial_mito3_mapa_a$UBIGEO=ifelse(0<provincial_mito3_mapa_a$UBIGEO&provincial_mito3_mapa_a$UBIGEO<999,paste(0,provincial_mito3_mapa_a$UBIGEO, sep = ""), provincial_mito3_mapa_a$UBIGEO)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
names(provincial_mito3_mapa_a)[4]="Número de organizaciones políticas candidatas 2002"
names(provincial_mito3_mapa_a)[5]="Número de organizaciones políticas candidatas 2006"
names(provincial_mito3_mapa_a)[6]="Número de organizaciones políticas candidatas 2010"
names(provincial_mito3_mapa_a)[7]="Número de organizaciones políticas candidatas 2014"
names(provincial_mito3_mapa_a)[8]="Número de organizaciones políticas candidatas 2018"
names(provincial_mito3_mapa_a)[9]="Número de organizaciones políticas candidatas 2022"
```


**Mapa de Número de Organizaciones Políticas de Elecciones Provinciales 2022**

```{r,results='hide',echo=FALSE,warning=FALSE,message=FALSE}
library(rgdal)
mapprov=readOGR("PROVINCIAS.shp") 
geoprov22=merge(mapprov,provincial_mito3_mapa_a,by.x="IDPROV",by.y="UBIGEO", all.x=T)
```


```{r, echo=FALSE,warning=FALSE,message=FALSE}
tmap_mode("view")
tm_shape(geoprov22) +
  tm_polygons(
    id="Provincia",
    col = "Número de organizaciones políticas candidatas 2022",
    breaks = c(4, 8, 12,Inf),
    pal = "YlOrBr",
        popup.vars=c("Número de organizaciones políticas candidatas 2002","Número de organizaciones políticas candidatas 2006","Número de organizaciones políticas candidatas 2010","Número de organizaciones políticas candidatas 2014","Número de organizaciones políticas candidatas 2018","Número de organizaciones políticas candidatas 2018","Número de organizaciones políticas candidatas 2022"),
   title = "Número de organizaciones políticas candidatas 2022",
    labels=c("4-7","8-11","12 a más")
    ) +
  #tm_facets(by = "Eleccion", ncol = 1) +
  tm_view(view.legend.position = c("left","bottom"))+
  tmap_options(check.and.fix = TRUE)
```




```{r,echo=FALSE,warning=FALSE,message=FALSE}
rm(provincial_mito3_mapa,provincial_mito3_mapa_a,provincial_mito3_prov,provincial_mito3_total)
```


## Elecciones Distritales

**Número de organizaciones políticas en total**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito3_total=distrital%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP) %>%
  unique%>%
  group_by(Eleccion)%>% 
  summarise(n=n())
```

|    **Elección**    | **Número de Org. Políticas** |
|:------------------:|:----------------------------:|
| **Distrital 2002** |             1494             |
| **Distrital 2006** |             544              |
| **Distrital 2010** |             547              |
| **Distrital 2014** |             396              |
| **Distrital 2018** |             149              |
| **Distrital 2022** |             127              |

**Número de organizaciones políticas por tipo**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito3_tipo=distrital%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP) %>%
  unique%>%
  group_by(Eleccion, Tipo_OP)%>% 
  summarise(n=n()) %>% 
  mutate(ratio=scales::percent(n/sum(n),accuracy = 0.1))


#library(knitr)
#library(kableExtra)
#kable(dcast(distrital_mito3_tipo, Eleccion ~ Tipo_OP, value.var = "n"))%>%kable_styling()
```



```{r,  echo=FALSE,warning=FALSE,message=FALSE}
##PARA MAPA: Número de org políticas por tipo y distrito

distrital_mito3_dist=distrital%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Region,Provincia,Distrito, Org_pol,Tipo_OP,Eleccion,UBIGEO) %>%
  dplyr::group_by(Region,Provincia, Distrito, Eleccion, Tipo_OP,UBIGEO)%>%
  summarise(n=n()) %>% 
  group_by(Eleccion, Region, Provincia, Distrito)%>%
  mutate(total_org_pol = sum(n)) %>% 
  mutate(ratio=scales::percent(n/total_org_pol,accuracy = 0.1))
```

```{r,  echo=FALSE,warning=FALSE,message=FALSE}
##PARA MAPA: Número de org políticas por tipo y distrito

distrital_mito3_mapa=merge(x=dcast(distrital_mito3_dist, UBIGEO + Region + Provincia + Distrito + Eleccion +total_org_pol ~ Tipo_OP, value.var = "n"), y=dcast(distrital_mito3_dist, UBIGEO + Region + Provincia + Distrito+Eleccion+total_org_pol ~ Tipo_OP, value.var = "ratio"), by= c("UBIGEO", "Region", "Provincia", "Distrito", "Eleccion","total_org_pol"), all = TRUE)
distrital_mito3_mapa[is.na(distrital_mito3_mapa)] = 0
names(distrital_mito3_mapa)[7]="alianza_n"
names(distrital_mito3_mapa)[8]="lista_n"
names(distrital_mito3_mapa)[9]="mov_n"
names(distrital_mito3_mapa)[10]="org_local_dist_n"
names(distrital_mito3_mapa)[11]="org_local_prov_n"
names(distrital_mito3_mapa)[12]="par_n"
names(distrital_mito3_mapa)[13]="alianza_n_por"
names(distrital_mito3_mapa)[14]="lista_n_por"
names(distrital_mito3_mapa)[15]="mov_n_por_por"
names(distrital_mito3_mapa)[16]="org_local_dist_n_por"
names(distrital_mito3_mapa)[17]="org_local_prov_n_por"
names(distrital_mito3_mapa)[18]="par_n_por"

#Nota: En 2022, debería haber 1694
#export(distrital_mito3_mapa,"distrital_mito3_mapa.xlsx")
```

**Mapa de Número de Organizaciones Políticas de Elecciones Distritales 2022**


```{r, echo=FALSE,warning=FALSE,message=FALSE}

distrital_mito3_mapa_a=dcast(distrital_mito3_mapa,UBIGEO + Region +Provincia +Distrito~ Eleccion,value.var = "total_org_pol")
```



```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito3_mapa_a$UBIGEO=ifelse(10000<distrital_mito3_mapa_a$UBIGEO&distrital_mito3_mapa_a$UBIGEO<100000,paste(0,distrital_mito3_mapa_a$UBIGEO, sep = ""), distrital_mito3_mapa_a$UBIGEO)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
names(distrital_mito3_mapa_a)[5]="Número de organizaciones políticas candidatas 2002"
names(distrital_mito3_mapa_a)[6]="Número de organizaciones políticas candidatas 2006"
names(distrital_mito3_mapa_a)[7]="Número de organizaciones políticas candidatas 2010"
names(distrital_mito3_mapa_a)[8]="Número de organizaciones políticas candidatas 2014"
names(distrital_mito3_mapa_a)[9]="Número de organizaciones políticas candidatas 2018"
names(distrital_mito3_mapa_a)[10]="Número de organizaciones políticas candidatas 2022"
```


```{r,results='hide',echo=FALSE,warning=FALSE,message=FALSE}
mapdist=readOGR("LIMITE_DISTRITAL_2020_INEI.shp") 
geodist22=merge(mapdist,distrital_mito3_mapa_a,by.x="UBIGEO",by.y="UBIGEO", duplicateGeoms = TRUE)
#geodist22=geodist22[complete.cases(geodist22@data$`% de votos no válidos`),] 
```


```{r, echo=FALSE,warning=FALSE,message=FALSE}
tmap_mode("view")
tm_shape(geodist22) +
  tm_polygons(
    id="NOMBDIST",
    col = "Número de organizaciones políticas candidatas 2022",
    breaks = c(0,6,11,16,20,Inf),
    pal = "YlOrBr" ,
    popup.vars=c("Número de organizaciones políticas candidatas 2002","Número de organizaciones políticas candidatas 2006","Número de organizaciones políticas candidatas 2010","Número de organizaciones políticas candidatas 2014","Número de organizaciones políticas candidatas 2018","Número de organizaciones políticas candidatas 2018","Número de organizaciones políticas candidatas 2022"),
    colorNA = "white",
    textNA = "Distrito capital sin elección",
    title = "Número de organizaciones políticas candidatas 2022",
    labels=c("0-5","6-10","11-15","16-20","De 20 a más")
    ) +
  #tm_facets(by = "Eleccion", ncol = 1)+
  tm_view(view.legend.position = c("left","bottom"))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
rm(list=ls())
```


<!--chapter:end:03-rganizaciones-políticas-candidatas.Rmd-->

# Movimientos regionales vs. Partidos Nacionales

<font size="6"> **Las Elecciones Regionales y Municipales son mayoritariamente una competencia entre movimientos regionales ¿verdadero o falso?**</font>

```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(googlesheets4)
regional=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vRJdUE26KIgGmrUT8DEUzY5f3JsGlK0-eQdoTeWQw2SPrGpA_bI54jpSDnyE-hBBAoIsBRiAJzoghy-/pub?gid=1313822542&single=true&output=csv",dec=".")
library(dplyr)
library(ggplot2)
library(rio)
library(car)
library(ggrepel)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
library(car)
regional$Tipo_OP<-recode(regional$Tipo_OP, "'PARTIDO POLÃ\u008dTICO'='PARTIDO POLITICO'")
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
provincial=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQUlZR5ccTPZzM1Uleflp7gomwKqGI3PCo4DijVl42CXoGl2WwVv7HBr0GJffWILL5b0nwkpP2XfPVF/pub?gid=2059395285&single=true&output=csv", dec = ".")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial$Tipo_OP<-recode(provincial$Tipo_OP, "'ORGANIZACIÃ“N LOCAL (PROVINCIAL)'='ORGANIZACION LOCAL PROVINCIAL'; 'PARTIDO POLÃ\u008dTICO'='PARTIDO POLITICO'")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital=read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQMLHdXuz-ykbp9VmJJGhtl0vdNeeMxjgod2YrYLt9UB3RdX8tb-LEbZr2PVV41Sj384LuK1quysfNj/pub?output=csv", dec='.')
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital$Tipo_OP<-recode(distrital$Tipo_OP, "'ORGANIZACIÃ“N LOCAL (PROVINCIAL)'='ORGANIZACION LOCAL PROVINCIAL';'ORGANIZACION LOCAL (DISTRITAL)'='ORGANIZACION LOCAL DISTRITAL'; 'PARTIDO POLÃ\u008dTICO'='PARTIDO POLITICO'")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
reg=regional%>%
     dplyr::filter(Eleccion=="Regional 2002"|Eleccion=="Regional 2006"|Eleccion=="Regional 2010"|Eleccion=="Regional 2014"|Eleccion=="Regional 2018"|Eleccion=="Regional 2022")%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS" & Vuelta == "Primera")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP)

prov=provincial%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP) 

dist=distrital%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
library(car)
reg$Eleccion<-recode(reg$Eleccion, "'Regional 2002'='2002'; 'Regional 2006'='2006'; 'Regional 2010'='2010'; 'Regional 2014'='2014'; 'Regional 2018'='2018';'Regional 2022'='2022'")
prov$Eleccion<-recode(prov$Eleccion, "'Provincial 2002'='2002'; 'Provincial 2006'='2006'; 'Provincial 2010'='2010'; 'Provincial 2014'='2014'; 'Provincial 2018'='2018';'Provincial 2022'='2022'")
dist$Eleccion<-recode(dist$Eleccion, "'Distrital 2002'='2002'; 'Distrital 2006'='2006'; 'Distrital 2010'='2010'; 'Distrital 2014'='2014'; 'Distrital 2018'='2018';'Distrital 2022'='2022'")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
cand_total=rbind(reg, prov, dist) 
cand_total$Eleccion=as.factor(cand_total$Eleccion)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
cand_total_graf=cand_total %>% 
  group_by(Eleccion,Tipo_OP) %>% 
  summarise(n=n())%>%
  mutate(ratio=scales::percent(n/sum(n), accuracy = 0.1)) %>% 
  mutate(n_por=n/sum(n))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(cand_total_graf, aes(x=Eleccion, y=n_por, group=Tipo_OP, color = Tipo_OP))+
  geom_line()+
  geom_point()+
  geom_text_repel(aes(label=ratio,vjust=-.9), colour="black", size=3)+
  ggtitle("Porcentaje de candidaturas en ERM (2002-2022) \n según tipo de organización")+
  xlab("Proceso Electoral")+
  ylab("Candidaturas (%)")+
  scale_color_manual(values = c("#55BA77","#06E3C3","#E55555","#122C74", "#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Distrital","Organización Local Provincial","Partido Político"))+
  labs(color = "")+
  theme_minimal()+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1),limit=c(0,0.7))+
  theme(legend.text = element_text(colour="black", size=9))+
  theme(legend.title = element_text(color = "black", size = 7))+
  theme(plot.title = element_text(hjust = 0.5))+
  theme(legend.position = "top")

#ggsave("5_general.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
rm(cand_total,cand_total_graf,dist,prov,reg)
```

## Elecciones Regionales



**Número de organizaciones candidatas por tipo**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
regional_mito5_tipo=regional%>%
    dplyr:: filter(Eleccion=="Regional 2002"|Eleccion=="Regional 2006"|Eleccion=="Regional 2010"|Eleccion=="Regional 2014"|Eleccion=="Regional 2018"|Eleccion=="Regional 2022")%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS" & Vuelta == "Primera")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP) %>%
  group_by(Eleccion, Tipo_OP)%>% 
  summarise(n=n())%>%
  mutate(ratio=scales::percent(n/sum(n),accuracy = 0.1))
```

|   **Elección**    | **Partido Político** | **Movimiento Regional** | **Alianza Electoral** | **Total** |
|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|
| **Regional 2002** |         149          |           52            |          22           |    223    |
| **Regional 2006** |         140          |           70            |          15           |    225    |
| **Regional 2010** |         138          |           140           |          17           |    295    |
| **Regional 2014** |         153          |           146           |          12           |    311    |
| **Regional 2018** |         223          |           91            |           0           |    314    |
| **Regional 2022** |         116          |           87            |           0           |    203    |

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(regional_mito5_tipo, aes(x = Eleccion, y=n, fill = Tipo_OP)) + 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold")+
  ggtitle("Porcentaje de candidaturas en Elecciones Regionales \nsegún tipo de organización")+
  xlab("Elección Regional")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Regional 2002" = "2002","Regional 2006" = "2006","Regional 2010" = "2010","Regional 2014" = "2014","Regional 2018" = "2018","Regional 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#E55555","#156C99"), labels = c("Alianza Electoral", "Movimiento Regional","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_regional_tipo.png")
```

**Porcentaje de candidaturas por tipo y región**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
regional_mito5_region=regional%>%
     dplyr::filter(Eleccion=="Regional 2002"|Eleccion=="Regional 2006"|Eleccion=="Regional 2010"|Eleccion=="Regional 2014"|Eleccion=="Regional 2018"|Eleccion=="Regional 2022")%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS" & Vuelta == "Primera")%>%
  dplyr::select(Region,Org_pol,Tipo_OP,Eleccion,UBIGEO) %>%
  group_by(Region,Eleccion, Tipo_OP,UBIGEO)%>%
  summarise(n=n()) %>%
  group_by(Eleccion, Region)%>%
  mutate(total_org_pol = sum(n)) %>% 
  mutate(ratio=scales::percent(n/total_org_pol,accuracy = 0.1)) %>% 
  mutate(Macrozona= ifelse(Region=="AMAZONAS"|Region=="LORETO"|Region=="SAN MARTIN"|Region=="UCAYALI", "ORIENTE", ifelse(Region=="APURIMAC"|Region=="AREQUIPA"|Region=="CUSCO"|Region=="MADRE DE DIOS"|Region=="MOQUEGUA"|Region=="PUNO"|Region=="TACNA", "SUR", ifelse(Region=="CAJAMARCA"|Region=="LA LIBERTAD"|Region=="LAMBAYEQUE"|Region=="PIURA"|Region=="TUMBES", "NORTE", ifelse(Region=="CALLAO"|Region=="LIMA", "LIMA Y CALLAO", "CENTRO")))))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
regional_mito5_region1=regional_mito5_region %>%
 dplyr::filter(Macrozona=="CENTRO")

regional_mito5_region2=regional_mito5_region %>%
 dplyr::filter(Macrozona=="LIMA Y CALLAO")

regional_mito5_region3=regional_mito5_region %>%
 dplyr::filter(Macrozona=="NORTE")

regional_mito5_region4=regional_mito5_region %>%
 dplyr::filter(Macrozona=="ORIENTE")

regional_mito5_region5=regional_mito5_region %>%
 dplyr::filter(Macrozona=="SUR")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = regional_mito5_region1, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Regionales \nsegún tipo de organización y región \nMacrozona Centro")+
  xlab("Elección Regional")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Regional 2002" = "2002","Regional 2006" = "2006","Regional 2010" = "2010","Regional 2014" = "2014","Regional 2018" = "2018","Regional 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#E55555","#156C99"), labels = c("Alianza Electoral", "Movimiento Regional","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_regional_regionA.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = regional_mito5_region2, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Regionales \nsegún tipo de organización y región \nMacrozona Lima y Callao")+
  xlab("Elección Regional")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Regional 2002" = "2002","Regional 2006" = "2006","Regional 2010" = "2010","Regional 2014" = "2014","Regional 2018" = "2018","Regional 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#E55555","#156C99"), labels = c("Alianza Electoral", "Movimiento Regional","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_regional_regionB.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = regional_mito5_region3, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Regionales \nsegún tipo de organización y región \nMacrozona Norte")+
  xlab("Elección Regional")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Regional 2002" = "2002","Regional 2006" = "2006","Regional 2010" = "2010","Regional 2014" = "2014","Regional 2018" = "2018","Regional 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#E55555","#156C99"), labels = c("Alianza Electoral", "Movimiento Regional","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_regional_regionC.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = regional_mito5_region4, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 2)+
  ggtitle("Porcentaje de candidaturas en Elecciones Regionales \nsegún tipo de organización y región \nMacrozona Oriente")+
  xlab("Elección Regional")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Regional 2002" = "2002","Regional 2006" = "2006","Regional 2010" = "2010","Regional 2014" = "2014","Regional 2018" = "2018","Regional 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#E55555","#156C99"), labels = c("Alianza Electoral", "Movimiento Regional","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_regional_regionD.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = regional_mito5_region5, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Regionales \nsegún tipo de organización y región \nMacrozona Sur")+
  xlab("Elección Regional")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Regional 2002" = "2002","Regional 2006" = "2006","Regional 2010" = "2010","Regional 2014" = "2014","Regional 2018" = "2018","Regional 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#E55555","#156C99"), labels = c("Alianza Electoral", "Movimiento Regional","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_regional_regionE.png")
```

```{r,  echo=FALSE,warning=FALSE,message=FALSE}
##PARA MAPA: Número de candidaturas por tipo y región

library(reshape2)
regional_mito5_mapa=merge(x=dcast(regional_mito5_region, UBIGEO + Region + Eleccion + total_org_pol ~ Tipo_OP, value.var = "n"), y=dcast(regional_mito5_region, UBIGEO + Region + Eleccion ~ Tipo_OP, value.var = "ratio"), by= c("UBIGEO", "Region", "Eleccion"), all = TRUE)
regional_mito5_mapa[is.na(regional_mito5_mapa)] = 0
names(regional_mito5_mapa)[5]="Número de Alianzas Electorales"
names(regional_mito5_mapa)[6]="Número de Movimientos Regionales"
names(regional_mito5_mapa)[7]="Número de Partidos Políticos"
names(regional_mito5_mapa)[8]="alianza_n_por"
names(regional_mito5_mapa)[9]="mov_n_por"
names(regional_mito5_mapa)[10]="par_n_por"

#export(regional_mito5_mapa,"regional_mito5_mapa.xlsx")
```

```{r}
regional_mito5_mapa=regional_mito5_mapa %>%
 dplyr::filter(Eleccion=="Regional 2022")
```


```{r,echo=FALSE,warning=FALSE,message=FALSE}
regional_mito5_mapa$UBIGEO=ifelse(0<regional_mito5_mapa$UBIGEO&regional_mito5_mapa$UBIGEO<10,paste(0,regional_mito5_mapa$UBIGEO, sep = ""), regional_mito5_mapa$UBIGEO)

```


```{r,results='hide', echo=FALSE,warning=FALSE,message=FALSE}
library(raster)
per_r=getData("GADM", country= "PER", level=1)
per_r=subset(per_r, NAME_1!="Lima Province" )
georeg22=merge(per_r,regional_mito5_mapa,by.x="CC_1",by.y="UBIGEO", duplicateGeoms = TRUE)

```

**Mapa de Tipo de Organizaciones Políticas de Elecciones Regionales 2022**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
library(tmap)
tmap_mode("view")
tm_shape(georeg22) +
  tm_polygons(
    id="Region",
    col = "Número de Movimientos Regionales",
    breaks = c(2, 4,6,Inf),
    pal = "GnBu" ,
    popup.vars=c("Número de Movimientos Regionales","Número de Partidos Políticos"),
    title = "Número de Movimientos Regionale 2022",
    labels=c("2-3","4-5","6-7")
    ) +
  #tm_facets(by = "Eleccion", ncol = 1) +
  tm_view(view.legend.position = c("left","bottom"))
```



## Elecciones Provinciales


```{r,  echo=FALSE,warning=FALSE,message=FALSE}
provincial_mito5_total=provincial%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP) %>%
  group_by(Eleccion)%>% 
  summarise(n=n())
```


**Número de candidaturas por tipo**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial_mito5_tipo=provincial%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP) %>%
  group_by(Eleccion, Tipo_OP)%>% 
  summarise(n=n()) %>% 
  mutate(ratio=scales::percent(n/sum(n),accuracy = 0.1))
```

|    **Elección**     | **Partido Político** | **Movimiento Regional** | **Alianza Electoral** | **Organización Local Provincial** | **Lista Independiente** | **Total** |
|:---------:|:---------:|:---------:|:---------:|:---------:|:---------:|:---------:|
| **Provincial 2002** |         1046         |           226           |          171          |                 0                 |           356           |   1779    |
| **Provincial 2006** |         1012         |           430           |          111          |                101                |            0            |   1654    |
| **Provincial 2010** |         846          |           754           |          112          |                42                 |            0            |   1754    |
| **Provincial 2014** |         817          |           908           |          62           |                42                 |            0            |   1829    |
| **Provincial 2018** |         1217         |           665           |           0           |                 3                 |            0            |   1885    |
| **Provincial 2022** |         762          |           629           |           0           |                 0                 |            0            |   1391    |

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(provincial_mito5_tipo, aes(x = Eleccion, y= n, fill = Tipo_OP)) + 
  geom_bar(stat="identity", position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Provinciales \nsegún tipo de organización")+
  xlab("Elección Provincial")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Provincial 2002" = "2002","Provincial 2006" = "2006","Provincial 2010" = "2010","Provincial 2014" = "2014","Provincial 2018" = "2018","Provincial 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#06E3C3","#E55555","#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Provincial","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_provincial_tipo.png")
```

**Porcentaje de candidaturas provinciales por tipo y región**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial_mito5_regionA=provincial%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS" & Provincia!= "LIMA")%>%
  dplyr::select(Region, Org_pol,Tipo_OP,Eleccion) %>%
  group_by(Region,Eleccion, Tipo_OP)%>%
  summarise(n=n()) %>%
  group_by(Eleccion, Region)%>%
  mutate(total_cand=sum(n)) %>% 
  mutate(ratio=scales::percent(n/sum(n),accuracy = 0.1))%>% 
  mutate(Macrozona= ifelse(Region=="AMAZONAS"|Region=="LORETO"|Region=="SAN MARTIN"|Region=="UCAYALI", "ORIENTE", ifelse(Region=="APURIMAC"|Region=="AREQUIPA"|Region=="CUSCO"|Region=="MADRE DE DIOS"|Region=="MOQUEGUA"|Region=="PUNO"|Region=="TACNA", "SUR", ifelse(Region=="CAJAMARCA"|Region=="LA LIBERTAD"|Region=="LAMBAYEQUE"|Region=="PIURA"|Region=="TUMBES", "NORTE", ifelse(Region=="CALLAO"|Region=="LIMA", "LIMA Y CALLAO", "CENTRO")))))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial_mito5_regionB=provincial%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS" & Provincia== "LIMA")%>%
  dplyr::select(Region, Org_pol,Tipo_OP,Eleccion) %>%
  group_by(Region,Eleccion, Tipo_OP)%>%
  summarise(n=n()) %>%
  group_by(Eleccion, Region)%>%
  mutate(total_cand=sum(n)) %>% 
  mutate(ratio=scales::percent(n/sum(n),accuracy = 0.1)) %>% 
  mutate(Macrozona="LIMA Y CALLAO")

library(car)
provincial_mito5_regionB$Region<-recode(provincial_mito5_regionB$Region, "'LIMA'='LIMA METROPOLITANA'")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial_mito5_region=rbind(provincial_mito5_regionA, provincial_mito5_regionB)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial_mito5_region1=provincial_mito5_region %>%
 dplyr::filter(Macrozona=="CENTRO")

provincial_mito5_region2=provincial_mito5_region %>%
 dplyr::filter(Macrozona=="LIMA Y CALLAO")

provincial_mito5_region3=provincial_mito5_region %>%
 dplyr::filter(Macrozona=="NORTE")

provincial_mito5_region4=provincial_mito5_region %>%
 dplyr::filter(Macrozona=="ORIENTE")

provincial_mito5_region5=provincial_mito5_region %>%
 dplyr::filter(Macrozona=="SUR")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = provincial_mito5_region1, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Provinciales \nsegún tipo de organización y región \nMacrozona Centro")+
  xlab("Elección Provincial")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Provincial 2002" = "2002","Provincial 2006" = "2006","Provincial 2010" = "2010","Provincial 2014" = "2014","Provincial 2018" = "2018","Provincial 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#06E3C3","#E55555","#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Provincial","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_provincial_regionA.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = provincial_mito5_region2, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Provinciales \nsegún tipo de organización y región \nMacrozona Lima y Callao")+
  xlab("Elección Provincial")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Provincial 2002" = "2002","Provincial 2006" = "2006","Provincial 2010" = "2010","Provincial 2014" = "2014","Provincial 2018" = "2018","Provincial 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#06E3C3","#E55555","#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Provincial","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_provincial_regionB.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = provincial_mito5_region3, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Provinciales \nsegún tipo de organización y región \nMacrozona Norte")+
  xlab("Elección Provincial")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Provincial 2002" = "2002","Provincial 2006" = "2006","Provincial 2010" = "2010","Provincial 2014" = "2014","Provincial 2018" = "2018","Provincial 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#06E3C3","#E55555","#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Provincial","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_provincial_regionC.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = provincial_mito5_region4, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 2)+
  ggtitle("Porcentaje de candidaturas en Elecciones Provinciales \nsegún tipo de organización y región \nMacrozona Oriente")+
  xlab("Elección Provincial")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Provincial 2002" = "2002","Provincial 2006" = "2006","Provincial 2010" = "2010","Provincial 2014" = "2014","Provincial 2018" = "2018","Provincial 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#06E3C3","#E55555","#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Provincial","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_provincial_regionD.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = provincial_mito5_region5, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Provinciales \nsegún tipo de organización y región \nMacrozona Sur")+
  xlab("Elección Provincial")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Provincial 2002" = "2002","Provincial 2006" = "2006","Provincial 2010" = "2010","Provincial 2014" = "2014","Provincial 2018" = "2018","Provincial 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#06E3C3","#E55555","#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Provincial","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_provincial_regionE.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
##PARA MAPA: Número de candidaturas por tipo y provincia

provincial_mito5_prov=provincial%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Region,Provincia, Org_pol,Tipo_OP,Eleccion,UBIGEO) %>%
  group_by(Region,Provincia,Eleccion, Tipo_OP,UBIGEO)%>%
  summarise(n=n()) %>% 
  group_by(Eleccion, Region, Provincia)%>%
  mutate(total_org_pol = sum(n)) %>% 
  mutate(ratio=scales::percent(n/total_org_pol,accuracy = 0.1))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial_mito5_mapa=merge(x=dcast(provincial_mito5_prov, UBIGEO + Region + Provincia + Eleccion +total_org_pol ~ Tipo_OP, value.var = "n"), y=dcast(provincial_mito5_prov, UBIGEO + Region + Provincia + Eleccion + total_org_pol ~ Tipo_OP, value.var = "ratio"), by= c("UBIGEO", "Region", "Provincia", "Eleccion", "total_org_pol"), all = TRUE)
provincial_mito5_mapa[is.na(provincial_mito5_mapa)] = 0
names(provincial_mito5_mapa)[6]="alianza_n"
names(provincial_mito5_mapa)[7]="lista_n"
names(provincial_mito5_mapa)[8]="Número de Movimientos Regionales"
names(provincial_mito5_mapa)[9]="org_local_prov_n"
names(provincial_mito5_mapa)[10]="Número de Partidos Nacionales"
names(provincial_mito5_mapa)[11]="alianza_n_por"
names(provincial_mito5_mapa)[12]="lista_n_por"
names(provincial_mito5_mapa)[13]="mov_n_por_por"
names(provincial_mito5_mapa)[14]="org_local_prov_n_por"
names(provincial_mito5_mapa)[15]="par_n_por"

#export(provincial_mito5_mapa,"provincial_mito5_mapa.xlsx")
```


```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial_mito5_mapa=provincial_mito5_mapa %>%
 dplyr::filter(Eleccion=="Provincial 2022")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
provincial_mito5_mapa$UBIGEO=ifelse(0<provincial_mito5_mapa$UBIGEO&provincial_mito5_mapa$UBIGEO<999,paste(0,provincial_mito5_mapa$UBIGEO, sep = ""), provincial_mito5_mapa$UBIGEO)
```

**Mapa de Tipo de Organizaciones Políticas de Elecciones Provinciales 2022**


```{r,results='hide',echo=FALSE,warning=FALSE,message=FALSE}
library(rgdal)
mapprov=readOGR("PROVINCIAS.shp") 
geoprov22=merge(mapprov,provincial_mito5_mapa,by.x="IDPROV",by.y="UBIGEO", all.x=T)
```


```{r, echo=FALSE,warning=FALSE,message=FALSE}
tmap_mode("view")
tm_shape(geoprov22) +
  tm_polygons(
    id="Provincia",
    col = "Número de Movimientos Regionales",
    breaks = c(0,3, 6, 9,Inf),
    pal = "GnBu",
        popup.vars=c("Número de Movimientos Regionales","Número de Partidos Nacionales"),
   title = "Número de Movimientos Regionales 2022",
    labels=c("0-2","3-5","6-8","De 9 a Más")
    ) +
  #tm_facets(by = "Eleccion", ncol = 1) +
  tm_view(view.legend.position = c("left","bottom"))+
  tmap_options(check.and.fix = TRUE)
```


## Elecciones Distritales



```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito5_total=distrital%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP) %>%
  group_by(Eleccion)%>% 
  summarise(n=n())
```

**Número de candidaturas por tipo**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito5_tipo=distrital%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Org_pol,Eleccion,Tipo_OP) %>%
  group_by(Eleccion, Tipo_OP)%>% 
  summarise(n=n()) %>% 
  mutate(ratio=scales::percent(n/sum(n),accuracy = 0.1))

#library(knitr)
#library(kableExtra)
#kable(dcast(distrital_mito3_tipo, Eleccion ~ Tipo_OP, value.var = "n"))%>%kable_styling()
```

|    **Elección**    | **Partido Político** | **Movimiento Regional** | **Alianza Electoral** | **Organización Local Provincial** | **Organización Local Distrital** | **Lista Independiente** | **Total** |
|:-------:|:-------:|:-------:|:-------:|:-------:|:-------:|:-------:|:-------:|
| **Distrital 2002** |         7472         |          1518           |         1218          |                 0                 |                0                 |          3012           |   13220   |
| **Distrital 2006** |         6775         |          2748           |          803          |                543                |               291                |            0            |   11160   |
| **Distrital 2010** |         5217         |          4946           |          799          |                180                |               278                |            0            |   11420   |
| **Distrital 2014** |         4741         |          5987           |          504          |                148                |               156                |            0            |   11536   |
| **Distrital 2018** |         7023         |          4540           |           0           |                18                 |                18                |            0            |   11599   |
| **Distrital 2022** |         4774         |          4354           |           0           |                 0                 |                0                 |            0            |   9128    |

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(distrital_mito5_tipo, aes(x = Eleccion, y= n, fill = Tipo_OP)) + 
  geom_bar(stat="identity", position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Distritales \nsegún tipo de organización")+
  xlab("Elección Distrital")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Distrital 2002" = "2002","Distrital 2006" = "2006","Distrital 2010" = "2010","Distrital 2014" = "2014","Distrital 2018" = "2018","Distrital 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#06E3C3","#E55555","#122C74", "#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Distrital","Organización Local Provincial","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_distrital_tipo.png")
```

**Numero de candidaturas distritales por tipo y region**

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito5_regionA=distrital%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS" & Provincia!= "LIMA")%>%
  dplyr::select(Region,Provincia,Distrito, Org_pol,Tipo_OP,Eleccion) %>%
  group_by(Region,Eleccion, Tipo_OP)%>%
  summarise(n=n()) %>% 
  group_by(Eleccion, Region)%>%
  mutate(total_cand = sum(n)) %>% 
  mutate(ratio=scales::percent(n/total_cand,accuracy = 0.1))%>% 
  mutate(Macrozona= ifelse(Region=="AMAZONAS"|Region=="LORETO"|Region=="SAN MARTIN"|Region=="UCAYALI", "ORIENTE", ifelse(Region=="APURIMAC"|Region=="AREQUIPA"|Region=="CUSCO"|Region=="MADRE DE DIOS"|Region=="MOQUEGUA"|Region=="PUNO"|Region=="TACNA", "SUR", ifelse(Region=="CAJAMARCA"|Region=="LA LIBERTAD"|Region=="LAMBAYEQUE"|Region=="PIURA"|Region=="TUMBES", "NORTE", ifelse(Region=="CALLAO"|Region=="LIMA", "LIMA Y CALLAO", "CENTRO")))))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito5_regionB=distrital%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS" & Provincia== "LIMA")%>%
  dplyr::select(Region,Provincia,Distrito, Org_pol,Tipo_OP,Eleccion) %>%
  group_by(Region,Eleccion, Tipo_OP)%>%
  summarise(n=n()) %>%
  group_by(Eleccion, Region)%>%
  mutate(total_cand=sum(n)) %>% 
  mutate(ratio=scales::percent(n/sum(n),accuracy = 0.1)) %>% 
  mutate(Macrozona="LIMA Y CALLAO")

library(car)
distrital_mito5_regionB$Region<-recode(distrital_mito5_regionB$Region, "'LIMA'='LIMA METROPOLITANA'")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito5_region=rbind(distrital_mito5_regionA, distrital_mito5_regionB)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito5_region1=distrital_mito5_region %>%
 dplyr::filter(Macrozona=="CENTRO")

distrital_mito5_region2=distrital_mito5_region %>%
 dplyr::filter(Macrozona=="LIMA Y CALLAO")

distrital_mito5_region3=distrital_mito5_region %>%
 dplyr::filter(Macrozona=="NORTE")

distrital_mito5_region4=distrital_mito5_region %>%
 dplyr::filter(Macrozona=="ORIENTE")

distrital_mito5_region5=distrital_mito5_region %>%
 dplyr::filter(Macrozona=="SUR")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = distrital_mito5_region1, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Distritales \nsegún tipo de organización y región \nMacrozona Centro")+
  xlab("Elección Distrital")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Distrital 2002" = "2002","Distrital 2006" = "2006","Distrital 2010" = "2010","Distrital 2014" = "2014","Distrital 2018" = "2018","Distrital 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#06E3C3","#E55555","#122C74", "#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Distrital","Organización Local Provincial","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_distrital_regionA.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = distrital_mito5_region2, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Distritales \nsegún tipo de organización y región \nMacrozona Lima y Callao")+
  xlab("Elección Distrital")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Distrital 2002" = "2002","Distrital 2006" = "2006","Distrital 2010" = "2010","Distrital 2014" = "2014","Distrital 2018" = "2018","Distrital 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#06E3C3","#E55555","#122C74", "#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Distrital","Organización Local Provincial","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_distrital_regionB.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = distrital_mito5_region3, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Distritales \nsegún tipo de organización y región \nMacrozona Norte")+
  xlab("Elección Distrital")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Distrital 2002" = "2002","Distrital 2006" = "2006","Distrital 2010" = "2010","Distrital 2014" = "2014","Distrital 2018" = "2018","Distrital 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#06E3C3","#E55555","#122C74", "#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Distrital","Organización Local Provincial","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_distrital_regionC.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = distrital_mito5_region4, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 2)+
  ggtitle("Porcentaje de candidaturas en Elecciones Distritales \nsegún tipo de organización y región \nMacrozona Oriente")+
  xlab("Elección Distrital")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Distrital 2002" = "2002","Distrital 2006" = "2006","Distrital 2010" = "2010","Distrital 2014" = "2014","Distrital 2018" = "2018","Distrital 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#06E3C3","#E55555","#122C74", "#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Distrital","Organización Local Provincial","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_distrital_regionD.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
ggplot(data = distrital_mito5_region5, aes(x = Eleccion, y= n, fill = Tipo_OP))+ 
  geom_bar(stat="identity",position = "fill")+
  geom_text(aes(label=ratio),position = position_fill(vjust=0.5),color="white", fontface="bold", size=1.5)+
  facet_wrap(~Region, ncol = 3)+
  ggtitle("Porcentaje de candidaturas en Elecciones Distritales \nsegún tipo de organización y región \nMacrozona Sur")+
  xlab("Elección Distrital")+ 
  ylab("Candidaturas (%)")+
  scale_x_discrete(labels = c("Distrital 2002" = "2002","Distrital 2006" = "2006","Distrital 2010" = "2010","Distrital 2014" = "2014","Distrital 2018" = "2018","Distrital 2022" = "2022"))+
  scale_fill_manual(values = c("#55BA77","#06E3C3","#E55555","#122C74", "#C18B3D", "#156C99"), labels = c("Alianza Electoral", "Lista Independiente", "Movimiento Regional", "Organización Local Distrital","Organización Local Provincial","Partido Político"))+
  labs(fill = "Tipo de organización política")+theme_minimal()+
  theme(axis.text = element_text(size=5))+
  theme(legend.text = element_text(colour="black", size=8))+
  theme(legend.title = element_text(color = "black", size = 8))+
  scale_y_continuous(labels = scales::percent)+
  theme(plot.title = element_text(hjust = 0.5))

#ggsave("5_distrital_regionE.png")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
##PARA MAPA: Número de candidaturas por tipo y distrito

distrital_mito5_dist=distrital%>%
  dplyr::filter(Org_pol!= "VOTOS EN BLANCO" & Org_pol!= "VOTOS NULOS")%>%
  dplyr::select(Region,Provincia,Distrito, Org_pol,Tipo_OP,Eleccion,UBIGEO) %>%
  group_by(Region,Provincia, Distrito, Eleccion, Tipo_OP,UBIGEO)%>%
  summarise(n=n()) %>% 
  group_by(Eleccion, Region, Provincia, Distrito)%>%
  mutate(total_org_pol = sum(n)) %>% 
  mutate(ratio=scales::percent(n/total_org_pol,accuracy = 0.1))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito5_mapa=merge(x=dcast(distrital_mito5_dist, UBIGEO + Region + Provincia + Distrito + Eleccion +total_org_pol ~ Tipo_OP, value.var = "n"), y=dcast(distrital_mito5_dist, UBIGEO + Region + Provincia + Distrito+Eleccion+total_org_pol ~ Tipo_OP, value.var = "ratio"), by= c("UBIGEO", "Region", "Provincia", "Distrito", "Eleccion","total_org_pol"), all = TRUE)
distrital_mito5_mapa[is.na(distrital_mito5_mapa)] = 0
names(distrital_mito5_mapa)[7]="alianza_n"
names(distrital_mito5_mapa)[8]="lista_n"
names(distrital_mito5_mapa)[9]="Número de Movimientos Regionales"
names(distrital_mito5_mapa)[10]="org_local_dist_n"
names(distrital_mito5_mapa)[11]="org_local_prov_n"
names(distrital_mito5_mapa)[12]="Número de Partidos Políticos"
names(distrital_mito5_mapa)[13]="alianza_n_por"
names(distrital_mito5_mapa)[14]="lista_n_por"
names(distrital_mito5_mapa)[15]="mov_n_por_por"
names(distrital_mito5_mapa)[16]="org_local_dist_n_por"
names(distrital_mito5_mapa)[17]="org_local_prov_n_por"
names(distrital_mito5_mapa)[18]="par_n_por"

#export(distrital_mito5_mapa,"distrital_mito5_mapa.xlsx")
```

**Mapa de Tipo de Organizaciones Políticas de Elecciones Distritales 2022**


```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito5_mapa=distrital_mito5_mapa %>%
 dplyr::filter(Eleccion=="Distrital 2022")
```


```{r, echo=FALSE,warning=FALSE,message=FALSE}
distrital_mito5_mapa$UBIGEO=ifelse(10000<distrital_mito5_mapa$UBIGEO&distrital_mito5_mapa$UBIGEO<100000,paste(0,distrital_mito5_mapa$UBIGEO, sep = ""), distrital_mito5_mapa$UBIGEO)
```


```{r,results='hide',echo=FALSE,warning=FALSE,message=FALSE}
mapdist=readOGR("LIMITE_DISTRITAL_2020_INEI.shp") 
geodist22=merge(mapdist,distrital_mito5_mapa,by.x="UBIGEO",by.y="UBIGEO", duplicateGeoms = TRUE)
#geodist22=geodist22[complete.cases(geodist22@data$`% de votos no válidos`),] 
```




```{r, echo=FALSE,warning=FALSE,message=FALSE}
tmap_mode("view")
tm_shape(geodist22) +
  tm_polygons(
    id="NOMBDIST",
    col = "Número de Movimientos Regionales",
    breaks = c(0,3,6,Inf),
    pal = "GnBu" ,
    popup.vars=c("Número de Movimientos Regionales","Número de Partidos Políticos"),
   title = ("Número de Movimientos Regionales 2022"),
    colorNA = "white",
    textNA = "Distrito capital sin eleccións",
    title = "Número de Movimientos Regionale",
    labels=c("0-2","3-5","6-8","De 9 a más")
    ) +
  #tm_facets(by = "Eleccion", ncol = 1)+
  tm_view(view.legend.position = c("left","bottom"))
```

```{r, echo=FALSE,warning=FALSE,message=FALSE}
rm(list=ls())
```

<!--chapter:end:04-movimientos-regionales-vs.-partidos-nacionales.Rmd-->

# Blocks

## Equations

Here is an equation.

\begin{equation} 
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:binom)
\end{equation} 

You may refer to using `\@ref(eq:binom)`, like see Equation \@ref(eq:binom).


## Theorems and proofs

Labeled theorems can be referenced in text using `\@ref(thm:tri)`, for example, check out this smart theorem \@ref(thm:tri).

::: {.theorem #tri}
For a right triangle, if $c$ denotes the *length* of the hypotenuse
and $a$ and $b$ denote the lengths of the **other** two sides, we have
$$a^2 + b^2 = c^2$$
:::

Read more here <https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html>.

## Callout blocks


The R Markdown Cookbook provides more help on how to use custom blocks to design your own callouts: https://bookdown.org/yihui/rmarkdown-cookbook/custom-blocks.html

<!--chapter:end:05-blocks.Rmd-->

# Sharing your book

## Publishing

HTML books can be published online, see: https://bookdown.org/yihui/bookdown/publishing.html

## 404 pages

By default, users will be directed to a 404 page if they try to access a webpage that cannot be found. If you'd like to customize your 404 page instead of using the default, you may add either a `_404.Rmd` or `_404.md` file to your project root and use code and/or Markdown syntax.

## Metadata for sharing

Bookdown HTML books will provide HTML metadata for social sharing on platforms like Twitter, Facebook, and LinkedIn, using information you provide in the `index.Rmd` YAML. To setup, set the `url` for your book and the path to your `cover-image` file. Your book's `title` and `description` are also used.



This `gitbook` uses the same social sharing data across all chapters in your book- all links shared will look the same.

Specify your book's source repository on GitHub using the `edit` key under the configuration options in the `_output.yml` file, which allows users to suggest an edit by linking to a chapter's source file. 

Read more about the features of this output format here:

https://pkgs.rstudio.com/bookdown/reference/gitbook.html

Or use:

```{r eval=FALSE}
?bookdown::gitbook
```



<!--chapter:end:06-share.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`

<!--chapter:end:07-references.Rmd-->

